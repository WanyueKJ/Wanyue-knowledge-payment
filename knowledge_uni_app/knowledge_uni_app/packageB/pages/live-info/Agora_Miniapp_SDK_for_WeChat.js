!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("AgoraSDK",[],t):"object"==typeof exports?exports.AgoraSDK=t():e.AgoraSDK=t()}(window,(function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=30)}([function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(27)),a=i(6),o=r(i(1)),l=i(2),u=i(3),h=()=>{};class c extends s.default{constructor(e,t){super(),this._state=y.RELAY_STATE_IDLE,this._onStatus=e=>{o.default.debug(`[${this.clientId}] ChannelMediaStatus: ${JSON.stringify(e)}`),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",v.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",v.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this._state=y.RELAY_STATE_FAILURE,this.emit("state",y.RELAY_STATE_FAILURE,E.SRC_TOKEN_EXPIRED)),"onDestTokenPrivilegeDidExpire"===e.command&&(this._state=y.RELAY_STATE_FAILURE,this.emit("state",y.RELAY_STATE_FAILURE,E.DEST_TOKEN_EXPIRED,e.channelName?{came:e.channelName}:null)))},this._onClose=()=>n(this,void 0,void 0,(function*(){if(o.default.debug(`[${this.clientId}] ChannelMediaSocket onClose`),this.emit("event",v.NETWORK_DISCONNECTED),this.state=y.RELAY_STATE_IDLE,this._prevChannelMediaConfig)try{yield this.startChannelMediaRelay(this._prevChannelMediaConfig)}catch(e){if(e instanceof p&&(e.message===f.WS_ABORT||e.message===f.AP_REQUEST_ABORT))return;this.emit("state",y.RELAY_STATE_FAILURE,E.SERVER_CONNECTION_LOST)}})),this.token=e.appId,this.appId=e.appId,this.cname=e.cname,this.uid=e.uid,this.sid=e.sid,this.clientId=t}set state(e){const t=this._state;this._state=e,t!==e&&this.emit("state",e)}get state(){return this._state}startChannelMediaRelay(e){return n(this,void 0,void 0,(function*(){if(this.state!==y.RELAY_STATE_IDLE)throw new p(f.BAD_STATE);this.state=y.RELAY_STATE_CONNECTING,yield this._connect(),o.default.debug(`[${this.clientId}] startChannelMediaRelay: connect success`),yield this._sendStartRelayMessage(e),this._prevChannelMediaConfig=e}))}updateChannelMediaRelay(e){return n(this,void 0,void 0,(function*(){if(this.state!==y.RELAY_STATE_RUNNING)throw new p(f.BAD_STATE);yield this._sendUpdateMessage(e),this._prevChannelMediaConfig=e}))}stopChannelMediaRelay(){return n(this,void 0,void 0,(function*(){yield this._sendStopRelayMessage(),o.default.debug(`[${this.clientId}] stopChannelMediaRelay: send stop message success`),this.state=y.RELAY_STATE_IDLE,this.dispose()}))}dispose(){o.default.debug(`[${this.clientId}] disposeChannelMediaRelay`),this.state=y.RELAY_STATE_IDLE,this.emit("dispose"),this._signal&&this._signal.dispose(),this._prevChannelMediaConfig=null,this.removeEvent()}_requestOneAP(e){return new Promise((t,i)=>{const n={command:"convergeAllocateEdge",sid:this.sid,appId:this.appId,token:"",ts:+new Date,version:a.VERSION,cname:this.cname,uid:this.uid+"",seq:1,requestId:1},r={service_name:"tele_channel",json_body:JSON.stringify(n)},s="https://"+e;wx.request({url:s,data:r,header:{"content-type":"application/json","X-Packet-Service-Type":0,"X-Packet-URI":61},method:"POST",success:e=>{let n=null,r=null;try{n=e.data}catch(e){i(new p(f.AP_JSON_PARSE_ERROR,e))}0!==n.code&&i(new p(f.AP_REQUEST_ERROR,n));try{r=JSON.parse(n.json_body)}catch(e){i(new p(f.AP_JSON_PARSE_ERROR,e))}200!==r.code&&i(new p(f.AP_REQUEST_ERROR,r)),r.servers?t(r.servers):i(new p(f.AP_JSON_PARSE_ERROR,r))},fail:e=>i(e)})})}_requestAP(){const e=["uap-ap-web-1.agora.io","uap-ap-web-2.agoraio.cn","uap-ap-web-3.agora.io","uap-ap-web-4.agoraio.cn"];return new Promise((t,i)=>{setTimeout(()=>{i(new p(f.AP_REQUEST_TIMEOUT))},3e3),this.on("dispose",()=>{i(new p(f.AP_REQUEST_ABORT))}),e.forEach(e=>{e+="/api/v1",this._requestOneAP(e).then(i=>{o.default.debug(`[${this.clientId}] startChannelMediaRelay request AP ${e} success: ${JSON.stringify(i)}`);const n=i[0];let r=(e=n.address).split("."),s=r.length;const a=`wss://miniapp.agoraio.cn/${r[s-4]}-${r[s-3]}-${r[s-2]}-${r[s-1]}-${n.ws}/`;t(a)}).catch(t=>{o.default.debug(`[${this.clientId}] startChannelMediaRelay request AP ${e} failed: ${JSON.stringify(t)}`)})})})}_connectWebsocket(e){return this._signal=new d(this.appId,this.cname,this.uid,this.sid),this._signal.connect(e)}_connect(){return n(this,void 0,void 0,(function*(){const e=yield this._requestAP();yield this._connectWebsocket(e),this._signal.on("close",this._onClose.bind(this)),this._signal.on("status",this._onStatus.bind(this)),this.emit("event",v.NETWORK_CONNECTED)}))}_sendStartRelayMessage(e){return n(this,void 0,void 0,(function*(){this._checkSignal();const t=this._genMessage(T.StopPacketTransfer);yield Promise.all([this._signal.request(t),this._signal.waitStatus("Normal Quit")]),o.default.debug(`[${this.clientId}] startChannelMediaRelay: StopPacketTransfer success`);const i=this._genMessage(T.SetSdkProfile,e);yield this._signal.request(i),o.default.debug(`[${this.clientId}] startChannelMediaRelay: SetSdkProfile success`);const n=this._genMessage(T.SetSourceChannel,e);yield Promise.all([this._signal.request(n),this._signal.waitStatus("SetSourceChannelStatus")]),this.emit("event",v.PACKET_JOINED_SRC_CHANNEL),o.default.debug(`[${this.clientId}] startChannelMediaRelay: SetSourceChannel success`);const r=this._genMessage(T.SetSourceUserId,e);yield this._signal.request(r),o.default.debug(`[${this.clientId}] startChannelMediaRelay: SetSourceUserId success`);const s=this._genMessage(T.SetDestChannel,e);yield Promise.all([this._signal.request(s),this._signal.waitStatus("SetDestChannelStatus")]),this.emit("event",v.PACKET_JOINED_DEST_CHANNEL),o.default.debug(`[${this.clientId}] startChannelMediaRelay: SetDestChannel success`);const a=this._genMessage(T.StartPacketTransfer,e);yield this._signal.request(a),this.emit("event",v.PACKET_SENT_TO_DEST_CHANNEL),this.state=y.RELAY_STATE_RUNNING,o.default.debug(`[${this.clientId}] startChannelMediaRelay: StartPacketTransfer success`)}))}_sendReconnectMessage(e){return n(this,void 0,void 0,(function*(){this._checkSignal();const t=this._genMessage(T.Reconnect,e);yield this._signal.request(t)}))}_sendUpdateMessage(e){return n(this,void 0,void 0,(function*(){this._checkSignal();const t=this._genMessage(T.UpdateDestChannel,e);yield this._signal.request(t),this.emit("event",v.PACKET_UPDATE_DEST_CHANNEL),o.default.debug(`[${this.clientId}] sendUpdateMessage: UpdateDestChannel success`)}))}_sendStopRelayMessage(){return n(this,void 0,void 0,(function*(){this._checkSignal();const e=this._genMessage(T.StopPacketTransfer);yield this._signal.request(e),o.default.debug(`[${this.clientId}] sendStopRelayMessage: StopPacketTransfer success`)}))}_genMessage(e,t){const i=[],n=[],r=[],s={appId:this.appId,cname:this.cname,uid:this.uid+"",sdkVersion:a.VERSION,sid:this.sid,ts:+new Date,requestId:0,seq:0,allocate:!0,clientRequest:{}};let o=null,l=null;switch(e){case T.SetSdkProfile:return s.clientRequest={command:"SetSdkProfile",type:"multi_channel"},s;case T.SetSourceChannel:return l=t.getSrcChannelMediaInfo(),s.clientRequest={command:"SetSourceChannel",uid:l.uid+"",channelName:l.channelName,token:l.token||this.appId},s;case T.SetSourceUserId:return l=t.getSrcChannelMediaInfo(),s.clientRequest={command:"SetSourceUserId",uid:this.uid+""},s;case T.SetDestChannel:return o=t.getDestChannelMediaInfos(),o.forEach(e=>{i.push(e.channelName),n.push(e.uid+""),r.push(e.token||this.appId)}),s.clientRequest={command:"SetDestChannel",channelName:i,uid:n,token:r},s;case T.StartPacketTransfer:return s.clientRequest={command:"StartPacketTransfer"},s;case T.Reconnect:return s.clientRequest={command:"Reconnect"},s;case T.StopPacketTransfer:return s.clientRequest={command:"StopPacketTransfer"},s;case T.UpdateDestChannel:return o=t.getDestChannelMediaInfos(),o.forEach(e=>{i.push(e.channelName),n.push(e.uid+""),r.push(e.token||this.appId)}),s.clientRequest={command:"UpdateDestChannel",channelName:i,uid:n,token:r},s}}_checkSignal(){if(!this._signal||!this._signal.isConnect())throw new p(f.WS_DISCONNECTED)}}t.default=c;t.ChannelMediaRelayConfiguration=class{constructor(){this.destChannelMediaInfos=new Map}setSrcChannelInfo(e){l.checkValidObject(e,"srcInfo");const{uid:t,channelName:i,token:n}=e;if(n&&!l.isValidToken(n))throw new Error("Invalid token in SrcChannelInfo");if(!l.isValidChannelName(i))throw new Error("Invalid channelName in SrcChannelInfo");if(!u.is32Uint(t))throw new Error("Invalid uid in SrcChannelInfo");o.default.debug("[setSrcChannelInfo]: srcInfo: ",e),this.srcChannelMediaInfo=e}setDestChannelInfo(e,t){if(!l.isValidChannelName(e))throw new Error("Invalid channelName in DestChannelInfo");l.checkValidObject(t,"destInfo");const{uid:i,token:n}=t,r=t.channelName;if(n&&!l.isValidToken(n))throw new Error("Invalid token in DestChannelInfo");if(!l.isValidChannelName(r))throw new Error("Invalid channelName in DestChannelInfo");if(!u.is32Uint(i))throw new Error("Invalid uid in DestChannelInfo");o.default.debug("[setDestChannelInfo]: destInfo: ",t,"channelName: ",e),this.destChannelMediaInfos.set(e,t)}removeDestChannelInfo(e){if(!l.isValidChannelName(e))throw new Error("Invalid channelName when invoke removeDestChannelInfo");o.default.debug("[removeDestChannelInfo]: channelName: ",e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfos(){return this.destChannelMediaInfos}};class d extends s.default{constructor(e,t,i,n){super(),this._onOpen=()=>{o.default.debug("[ChannelMediaRelay] onOpen"),this.emit("open")},this._onClose=e=>{o.default.debug("[ChannelMediaRelay] onClose"),this.emit("close"),this.dispose()},this._onMessage=e=>{o.default.blind("ChannelMediaRelay receive message",e);const t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_"+t.requestId,t)},this._requestId=1,this.appId=e,this.cname=t,this.uid=i,this.sid=n}isConnect(){return this._ws&&1===this._ws.readyState}sendMessage(e){if(!this._ws||1!==this._ws.readyState)throw new p(f.WS_DISCONNECTED);const t=this._requestId++;return e.requestId=t,e.seq=t,this._ws.send({data:JSON.stringify(e)}),t}waitStatus(e){return new Promise((t,i)=>{const n=setTimeout(()=>{i(new p(f.WAIT_STATUS_TIMEOUT,e))},5e3);this.once(e,r=>{clearTimeout(n),r.state&&0!==r.state?i(new p(f.WAIT_STATUS_ERROR,e)):t()}),this.once("dispose",()=>{clearTimeout(n),i(new p(f.WS_ABORT))})})}request(e){return new Promise((t,i)=>{const n=this.sendMessage(e),r=setTimeout(()=>{this.removeAllListeners("req_"+n),i(new p(f.REQUEST_TIMEOUT))},3e3);this.once("req_"+n,e=>{clearTimeout(r),e&&200===e.code?t(e):i(new p(f.REQUEST_FAILED,e))}),this.once("dispose",()=>{clearTimeout(r),i(new p(f.WS_ABORT))})})}connect(e){return new Promise((t,i)=>{this._ws=wx.connectSocket({url:e}),this._ws.onOpen((i,n)=>{o.default.debug("[ChannelMediaRelay] ws.onOpen"),this._onOpen(),this._prvUrl=e,this._ws.onMessage(this._onMessage),this._ws.onClose(this._onClose),this._startHeartBeatCheck(),t()}),this._ws.onClose(e=>{o.default.debug("[ChannelMediaRelay] ws.onClose",e),this.dispose(),i(new p(f.CONNECT_FAILED,"websocket error code: "+e.code))}),setTimeout(()=>{this._ws&&1!==this._ws.readyState&&(this._ws.onMessage(h),this._ws.onClose(h),this._ws.close(),this._ws=null,i(new p(f.CONNECT_TIMEOUT)))},5e3),this.once("dispose",()=>{i(new p(f.WS_ABORT))})})}dispose(){o.default.debug("[ChannelMediaRelay] dispose"),this._clearHeartBeatCheck(),this.emit("dispose"),this.removeEvent(),this._ws&&(this._ws.onOpen(h),this._ws.onClose(h),this._ws.onMessage(h),this._ws.close(h)),this._ws=null}_sendPing(e){if(!this._ws||1!==this._ws.readyState)throw new p(f.WS_DISCONNECTED);const t=this._requestId++;return e.requestId=t,this._ws.send({data:JSON.stringify(e)}),t}_startHeartBeatCheck(){this._heartBeatTimer=setInterval(()=>{this._sendPing({command:"ping",appId:this.appId,cname:this.cname,uid:this.uid+"",sid:this.sid,ts:+new Date,requestId:0})},3e3)}_clearHeartBeatCheck(){clearInterval(this._heartBeatTimer)}}class p{constructor(e="",t,i){this.code=i,this.data=t,this.message=e}}var f,T,v,y,E;t.ChannelMediaError=p,function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(f=t.CHANNEL_MEDIA_ERROR||(t.CHANNEL_MEDIA_ERROR={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(T||(T={})),function(e){e[e.NETWORK_DISCONNECTED=0]="NETWORK_DISCONNECTED",e[e.NETWORK_CONNECTED=1]="NETWORK_CONNECTED",e[e.PACKET_JOINED_SRC_CHANNEL=2]="PACKET_JOINED_SRC_CHANNEL",e[e.PACKET_JOINED_DEST_CHANNEL=3]="PACKET_JOINED_DEST_CHANNEL",e[e.PACKET_SENT_TO_DEST_CHANNEL=4]="PACKET_SENT_TO_DEST_CHANNEL",e[e.PACKET_RECEIVED_VIDEO_FROM_SRC=5]="PACKET_RECEIVED_VIDEO_FROM_SRC",e[e.PACKET_RECEIVED_AUDIO_FROM_SRC=6]="PACKET_RECEIVED_AUDIO_FROM_SRC",e[e.PACKET_UPDATE_DEST_CHANNEL=7]="PACKET_UPDATE_DEST_CHANNEL",e[e.PACKET_UPDATE_DEST_CHANNEL_REFUSED=8]="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e[e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE=9]="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(v=t.CHANNEL_MEDIA_RELAY_EVENT||(t.CHANNEL_MEDIA_RELAY_EVENT={})),function(e){e[e.RELAY_STATE_IDLE=0]="RELAY_STATE_IDLE",e[e.RELAY_STATE_CONNECTING=1]="RELAY_STATE_CONNECTING",e[e.RELAY_STATE_RUNNING=2]="RELAY_STATE_RUNNING",e[e.RELAY_STATE_FAILURE=3]="RELAY_STATE_FAILURE"}(y=t.CHANNEL_MEDIA_RELAY_STATE||(t.CHANNEL_MEDIA_RELAY_STATE={})),function(e){e[e.RELAY_OK=0]="RELAY_OK",e[e.SERVER_ERROR_RESPONSE=1]="SERVER_ERROR_RESPONSE",e[e.SERVER_NO_RESPONSE=2]="SERVER_NO_RESPONSE",e[e.NO_RESOURCE_AVAILABLE=3]="NO_RESOURCE_AVAILABLE",e[e.FAILED_JOIN_SRC=4]="FAILED_JOIN_SRC",e[e.FAILED_JOIN_DEST=5]="FAILED_JOIN_DEST",e[e.FAILED_PACKET_RECEIVED_FROM_SRC=6]="FAILED_PACKET_RECEIVED_FROM_SRC",e[e.FAILED_PACKET_SENT_TO_DEST=7]="FAILED_PACKET_SENT_TO_DEST",e[e.SERVER_CONNECTION_LOST=8]="SERVER_CONNECTION_LOST",e[e.INTERNAL_ERROR=9]="INTERNAL_ERROR",e[e.SRC_TOKEN_EXPIRED=10]="SRC_TOKEN_EXPIRED",e[e.DEST_TOKEN_EXPIRED=11]="DEST_TOKEN_EXPIRED",e[e.RELAY_ALREADY_START=12]="RELAY_ALREADY_START",e[e.RELAY_NOT_START=13]="RELAY_NOT_START",e[e.OPERATION_ABORT=14]="OPERATION_ABORT"}(E=t.CHANNEL_MEDIA_RELAY_ERROR||(t.CHANNEL_MEDIA_RELAY_ERROR={}))},function(e,t,i){"use strict";i.r(t),i.d(t,"Log",(function(){return u}));var n=i(9),r=i.n(n),s=i(4),a=i.n(s),o=i(5),l=i.n(o),u=function(){function e(){a()(this,e),this.level=3,this.onLog=null}return l()(e,[{key:"setLogLevel",value:function(e){if("number"!=typeof e||!(e<=4&&e>=-1))throw Error("Invaild level");this.level=e}},{key:"log",value:function(){var e,t=Array.prototype.slice.call(arguments);this.onLog&&this.onLog(JSON.stringify(t)),(e=console).log.apply(e,r()(t))}},{key:"error",value:function(){var e,t=Array.prototype.slice.call(arguments);this.onLog&&this.onLog(JSON.stringify(t)),(e=console).error.apply(e,r()(t))}},{key:"blind",value:function(){var e=Array.prototype.slice.call(arguments);this.level<=-1&&this.log.apply(this,["".concat(new Date," [BLIND]: ")].concat(r()(e)))}},{key:"debug",value:function(){var e=Array.prototype.slice.call(arguments);this.level<=0&&this.log.apply(this,["".concat(new Date," [DEBUG]: ")].concat(r()(e)))}},{key:"info",value:function(e){this.level<=1&&this.log("".concat(new Date," [INFO]: ").concat(e))}},{key:"warn",value:function(e){this.level<=2&&this.log("".concat(new Date," [WARN]: ").concat(e))}},{key:"error",value:function(e){this.level<=3&&this.error("".concat(new Date," [ERROR]: ").concat(e))}}]),e}(),h=new u;t.default=h},function(e,t,i){"use strict";i.r(t),i.d(t,"checkValidObject",(function(){return a})),i.d(t,"checkValidString",(function(){return o})),i.d(t,"checkValidNumber",(function(){return l})),i.d(t,"checkValidFloatNumber",(function(){return u})),i.d(t,"checkValidBoolean",(function(){return h})),i.d(t,"checkValidEnum",(function(){return s})),i.d(t,"isValidString",(function(){return c})),i.d(t,"isValidNumber",(function(){return d})),i.d(t,"isValidBoolean",(function(){return f})),i.d(t,"isASCII",(function(){return y})),i.d(t,"isInteger",(function(){return E})),i.d(t,"isNumber",(function(){return S})),i.d(t,"isString",(function(){return g})),i.d(t,"isArray",(function(){return w})),i.d(t,"isEmpty",(function(){return m})),i.d(t,"isValidToken",(function(){return T})),i.d(t,"isValidChannelName",(function(){return v}));var n=i(16),r=i.n(n),s=function(e,t,i){for(var n=0;n<i.length;n++)if(e===i[n])return!0;throw new Error("".concat(t," can only be set as ").concat(JSON.stringify(i)))},a=function(e,t){if(!e)throw new Error("Invalid param: ".concat(t||"param"," cannot be empty"));if("object"!==r()(e))throw new Error("".concat(t||"This paramter"," is of the object type"));return!0},o=function(e,t,i,n,r){if(m(i)&&(i=1),n=n||255,m(r)&&(r=!0),m(e))throw new Error("".concat(t||"param"," cannot be empty"));if(!c(e,i,n,r))throw new Error("Invalid ".concat(t||"string param",": Length of the string: [").concat(i,",").concat(n,"].").concat(r?" ASCII characters only.":""))},l=function(e,t,i,n){if(m(i)&&(i=1),n=n||1e4,m(e))throw new Error("".concat(t||"param"," cannot be empty"));if(!d(e,i,n))throw new Error("Invalid ".concat(t||"number param",": The value range is [").concat(i,",").concat(n,"]. integer only"))},u=function(e,t,i,n){if(null==e)throw new Error("".concat(t||"param"," cannot be null"));if(m(i)&&(i=0),n=n||1e4,m(e))throw new Error("".concat(t||"param"," cannot be empty"));if(!p(e,i,n))throw new Error("Invalid ".concat(t||"number param",": The value range is [").concat(i,",").concat(n,"]."))},h=function(e,t){if(m(e))throw new Error("".concat(t||"param"," cannot be empty"));if(!f(e))throw new Error("Invalid ".concat(t||"boolean param",": The value is of the boolean type."))},c=function(e,t,i,n){return t||(t=0),i||(i=Number.MAX_SAFE_INTEGER),m(n)&&(n=!0),g(e)&&(!n||y(e))&&e.length>=t&&e.length<=i},d=function(e,t,i){return E(e)&&e>=t&&e<=i},p=function(e,t,i){return S(e)&&e>=t&&e<=i},f=function(e){return"boolean"==typeof e},T=function(e){return c(e,1,2047)},v=function(e){return g(e)&&/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e)},y=function(e){if("string"==typeof e){for(var t=0;t<e.length;t++){var i=e.charCodeAt(t);if(i<0||i>255)return!1}return!0}},E=function(e){return"number"==typeof e&&e%1==0},S=function(e){return"number"==typeof e},g=function(e){return"string"==typeof e},w=function(e){return e instanceof Array},m=function(e){return null==e}},function(e,t,i){"use strict";i.r(t),i.d(t,"generateSessionId",(function(){return a})),i.d(t,"shouldUseHttps",(function(){return o})),i.d(t,"random",(function(){return s})),i.d(t,"isWeiXin",(function(){return l})),i.d(t,"is32Uint",(function(){return u}));var n=i(15),r=i.n(n),s=function(e){isNaN(e)&&(e=1e3);var t=+new Date,i=(t=(9301*t+49297)%233280)/233280;return Math.ceil(i*e)},a=function(){return r()().replace(/-/g,"").toUpperCase()},o=function(){return"https:"==document.location.protocol},l=function(){try{return wx,!0}catch(e){return!1}},u=function(e){return!!(0<=e&&e<=4294967295)}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}},function(e,t,i){"use strict";i.r(t),i.d(t,"VERSION",(function(){return n})),i.d(t,"SDK_VERSION",(function(){return r})),i.d(t,"DOMAIN_NAME",(function(){return s}));var n="1.1.0",r="2.4.5",s="mini-app.broadcastapp.agoraio.cn"},function(e,t,i){e.exports=i(19)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var Thrift={Version:"0.11.0",Type:{STOP:0,VOID:1,BOOL:2,BYTE:3,I08:3,DOUBLE:4,I16:6,I32:8,I64:10,STRING:11,UTF7:11,STRUCT:12,MAP:13,SET:14,LIST:15,UTF8:16,UTF16:17},MessageType:{CALL:1,REPLY:2,EXCEPTION:3,ONEWAY:4},objectLength:function(e){var t=0;for(var i in e)e.hasOwnProperty(i)&&t++;return t},inherits:function(e,t,i){function n(){}n.prototype=t.prototype,e.prototype=new n,e.prototype.name=i||""}},_copyList,_copyMap;Thrift.TException=function(e){this.message=e},Thrift.inherits(Thrift.TException,Error,"TException"),Thrift.TException.prototype.getMessage=function(){return this.message},Thrift.TApplicationExceptionType={UNKNOWN:0,UNKNOWN_METHOD:1,INVALID_MESSAGE_TYPE:2,WRONG_METHOD_NAME:3,BAD_SEQUENCE_ID:4,MISSING_RESULT:5,INTERNAL_ERROR:6,PROTOCOL_ERROR:7,INVALID_TRANSFORM:8,INVALID_PROTOCOL:9,UNSUPPORTED_CLIENT_TYPE:10},Thrift.TApplicationException=function(e,t){this.message=e,this.code="number"==typeof t?t:0},Thrift.inherits(Thrift.TApplicationException,Thrift.TException,"TApplicationException"),Thrift.TApplicationException.prototype.read=function(e){for(;;){var t=e.readFieldBegin();if(t.ftype==Thrift.Type.STOP)break;switch(t.fid){case 1:t.ftype==Thrift.Type.STRING?(t=e.readString(),this.message=t.value):t=e.skip(t.ftype);break;case 2:t.ftype==Thrift.Type.I32?(t=e.readI32(),this.code=t.value):t=e.skip(t.ftype);break;default:t=e.skip(t.ftype)}e.readFieldEnd()}e.readStructEnd()},Thrift.TApplicationException.prototype.write=function(e){e.writeStructBegin("TApplicationException"),this.message&&(e.writeFieldBegin("message",Thrift.Type.STRING,1),e.writeString(this.getMessage()),e.writeFieldEnd()),this.code&&(e.writeFieldBegin("type",Thrift.Type.I32,2),e.writeI32(this.code),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()},Thrift.TApplicationException.prototype.getCode=function(){return this.code},Thrift.TProtocolExceptionType={UNKNOWN:0,INVALID_DATA:1,NEGATIVE_SIZE:2,SIZE_LIMIT:3,BAD_VERSION:4,NOT_IMPLEMENTED:5,DEPTH_LIMIT:6},Thrift.TProtocolException=function(e,t){Error.call(this),Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.type=e,this.message=t},Thrift.inherits(Thrift.TProtocolException,Thrift.TException,"TProtocolException"),Thrift.Transport=Thrift.TXHRTransport=function(e,t){this.url=e,this.wpos=0,this.rpos=0,this.useCORS=t&&t.useCORS,this.customHeaders=t&&t.customHeaders?t.customHeaders:{},this.send_buf="",this.recv_buf=""},Thrift.TXHRTransport.prototype={getXmlHttpRequestObject:function(){try{return new XMLHttpRequest}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}throw"Your browser doesn't support XHR."},flush:function(e,t){var i=this;if(e&&!t||void 0===this.url||""===this.url)return this.send_buf;var n,r={};r.header={},r.method="POST",r.header.MediaType="application/vnd.apache.thrift.json; charset=utf-8",t&&(r.success=(n=t,function(e){if(i.responseText=JSON.stringify(e.data),i.setRecvBuffer(i.responseText),e&&200!==e.statusCode)return n(e.statusCode);n()}),r.fail=function(){var e=t;return function(t){e(t)}}()),Object.keys(i.customHeaders).forEach((function(e){r.header[e]=i.customHeaders[e]})),r.header.Accept="application/vnd.apache.thrift.json; charset=utf-8",r.header["Content-Type"]="application/vnd.apache.thrift.json; charset=utf-8",r.data=this.send_buf,r.url=this.url,wx.request(r)},jqRequest:function(e,t,i,n){if("undefined"==typeof jQuery||void 0===jQuery.Deferred)throw"Thrift.js requires jQuery 1.5+ to use asynchronous requests";var r=this;return jQuery.ajax({url:this.url,data:t,type:"POST",cache:!1,contentType:"application/vnd.apache.thrift.json; charset=utf-8",dataType:"text thrift",converters:{"text thrift":function(t){return r.setRecvBuffer(t),n.call(e)}},context:e,success:jQuery.makeArray(i).pop()})},setRecvBuffer:function(e){this.recv_buf=e,this.recv_buf_sz=this.recv_buf.length,this.wpos=this.recv_buf.length,this.rpos=0},isOpen:function(){return!0},open:function(){},close:function(){},read:function(e){var t=this.wpos-this.rpos;if(0===t)return"";var i=e;t<e&&(i=t);var n=this.read_buf.substr(this.rpos,i);return this.rpos+=i,n},readAll:function(){return this.recv_buf},write:function(e){this.send_buf=e},getSendBuffer:function(){return this.send_buf}},Thrift.TWebSocketTransport=function(e){this.__reset(e)},Thrift.TWebSocketTransport.prototype={__reset:function(e){this.url=e,this.socket=null,this.callbacks=[],this.send_pending=[],this.send_buf="",this.recv_buf="",this.rb_wpos=0,this.rb_rpos=0},flush:function(e,t){var i,n=this;this.isOpen()?(this.socket.send(this.send_buf),this.callbacks.push((i=t,function(e){n.setRecvBuffer(e),i()})),t&&this.callbacks.push(function(){var e=t;return function(t){n.setRecvBuffer(t),e()}}())):this.send_pending.push({buf:this.send_buf,cb:t})},__onOpen:function(){var e=this;this.send_pending.length>0&&(this.send_pending.forEach((function(t){var i;this.socket.send(t.buf),this.callbacks.push((i=t.cb,function(t){e.setRecvBuffer(t),i()}))})),this.send_pending=[])},__onClose:function(e){this.__reset(this.url)},__onMessage:function(e){this.callbacks.length&&this.callbacks.shift()(e.data)},__onError:function(e){console.log("Thrift WebSocket Error: "+e.toString()),this.socket.close()},setRecvBuffer:function(e){this.recv_buf=e,this.recv_buf_sz=this.recv_buf.length,this.wpos=this.recv_buf.length,this.rpos=0},isOpen:function(){return this.socket&&this.socket.readyState==this.socket.OPEN},open:function(){this.socket&&this.socket.readyState!=this.socket.CLOSED||(this.socket=new WebSocket(this.url),this.socket.onopen=this.__onOpen.bind(this),this.socket.onmessage=this.__onMessage.bind(this),this.socket.onerror=this.__onError.bind(this),this.socket.onclose=this.__onClose.bind(this))},close:function(){this.socket.close()},read:function(e){var t=this.wpos-this.rpos;if(0===t)return"";var i=e;t<e&&(i=t);var n=this.read_buf.substr(this.rpos,i);return this.rpos+=i,n},readAll:function(){return this.recv_buf},write:function(e){this.send_buf=e},getSendBuffer:function(){return this.send_buf}},Thrift.TJSONProtocol=Thrift.Protocol=function(e){this.tstack=[],this.tpos=[],this.transport=e},Thrift.Protocol.Type={},Thrift.Protocol.Type[Thrift.Type.BOOL]='"tf"',Thrift.Protocol.Type[Thrift.Type.BYTE]='"i8"',Thrift.Protocol.Type[Thrift.Type.I16]='"i16"',Thrift.Protocol.Type[Thrift.Type.I32]='"i32"',Thrift.Protocol.Type[Thrift.Type.I64]='"i64"',Thrift.Protocol.Type[Thrift.Type.DOUBLE]='"dbl"',Thrift.Protocol.Type[Thrift.Type.STRUCT]='"rec"',Thrift.Protocol.Type[Thrift.Type.STRING]='"str"',Thrift.Protocol.Type[Thrift.Type.MAP]='"map"',Thrift.Protocol.Type[Thrift.Type.LIST]='"lst"',Thrift.Protocol.Type[Thrift.Type.SET]='"set"',Thrift.Protocol.RType={},Thrift.Protocol.RType.tf=Thrift.Type.BOOL,Thrift.Protocol.RType.i8=Thrift.Type.BYTE,Thrift.Protocol.RType.i16=Thrift.Type.I16,Thrift.Protocol.RType.i32=Thrift.Type.I32,Thrift.Protocol.RType.i64=Thrift.Type.I64,Thrift.Protocol.RType.dbl=Thrift.Type.DOUBLE,Thrift.Protocol.RType.rec=Thrift.Type.STRUCT,Thrift.Protocol.RType.str=Thrift.Type.STRING,Thrift.Protocol.RType.map=Thrift.Type.MAP,Thrift.Protocol.RType.lst=Thrift.Type.LIST,Thrift.Protocol.RType.set=Thrift.Type.SET,Thrift.Protocol.Version=1,Thrift.Protocol.prototype={getTransport:function(){return this.transport},writeMessageBegin:function(e,t,i){this.tstack=[],this.tpos=[],this.tstack.push([Thrift.Protocol.Version,'"'+e+'"',t,i])},writeMessageEnd:function(){var e=this.tstack.pop();this.wobj=this.tstack.pop(),this.wobj.push(e),this.wbuf="["+this.wobj.join(",")+"]",this.transport.write(this.wbuf)},writeStructBegin:function(e){this.tpos.push(this.tstack.length),this.tstack.push({})},writeStructEnd:function(){var e=this.tpos.pop(),t=this.tstack[e],i="{",n=!0;for(var r in t)n?n=!1:i+=",",i+=r+":"+t[r];i+="}",this.tstack[e]=i},writeFieldBegin:function(e,t,i){this.tpos.push(this.tstack.length),this.tstack.push({fieldId:'"'+i+'"',fieldType:Thrift.Protocol.Type[t]})},writeFieldEnd:function(){var e=this.tstack.pop(),t=this.tstack.pop();this.tstack[this.tstack.length-1][t.fieldId]="{"+t.fieldType+":"+e+"}",this.tpos.pop()},writeFieldStop:function(){},writeMapBegin:function(e,t,i){this.tpos.push(this.tstack.length),this.tstack.push([Thrift.Protocol.Type[e],Thrift.Protocol.Type[t],0])},writeMapEnd:function(){var e=this.tpos.pop();if(e!=this.tstack.length){(this.tstack.length-e-1)%2!=0&&this.tstack.push("");var t=(this.tstack.length-e-1)/2;this.tstack[e][this.tstack[e].length-1]=t;for(var i="}",n=!0;this.tstack.length>e+1;){var r=this.tstack.pop(),s=this.tstack.pop();n?n=!1:i=","+i,isNaN(s)||(s='"'+s+'"'),i=s+":"+r+i}i="{"+i,this.tstack[e].push(i),this.tstack[e]="["+this.tstack[e].join(",")+"]"}},writeListBegin:function(e,t){this.tpos.push(this.tstack.length),this.tstack.push([Thrift.Protocol.Type[e],t])},writeListEnd:function(){for(var e=this.tpos.pop();this.tstack.length>e+1;){var t=this.tstack[e+1];this.tstack.splice(e+1,1),this.tstack[e].push(t)}this.tstack[e]="["+this.tstack[e].join(",")+"]"},writeSetBegin:function(e,t){this.tpos.push(this.tstack.length),this.tstack.push([Thrift.Protocol.Type[e],t])},writeSetEnd:function(){for(var e=this.tpos.pop();this.tstack.length>e+1;){var t=this.tstack[e+1];this.tstack.splice(e+1,1),this.tstack[e].push(t)}this.tstack[e]="["+this.tstack[e].join(",")+"]"},writeBool:function(e){this.tstack.push(e?1:0)},writeByte:function(e){this.tstack.push(e)},writeI16:function(e){this.tstack.push(e)},writeI32:function(e){this.tstack.push(e)},writeI64:function(e){this.tstack.push(e)},writeDouble:function(e){this.tstack.push(e)},writeString:function(e){if(null===e)this.tstack.push(null);else{for(var t="",i=0;i<e.length;i++){var n=e.charAt(i);t+='"'===n?'\\"':"\\"===n?"\\\\":"\b"===n?"\\b":"\f"===n?"\\f":"\n"===n?"\\n":"\r"===n?"\\r":"\t"===n?"\\t":n}this.tstack.push('"'+t+'"')}},writeBinary:function(e){var t="";if("string"==typeof e)t=e;else{if(!(e instanceof Uint8Array))throw new TypeError("writeBinary only accepts String or Uint8Array.");for(var i=e,n=0;n<i.length;++n)t+=String.fromCharCode(i[n])}this.tstack.push('"'+btoa(t)+'"')},readMessageBegin:function readMessageBegin(){if(this.rstack=[],this.rpos=[],"undefined"!=typeof JSON&&"function"==typeof JSON.parse){var a=this.transport.readAll();this.robj=JSON.parse(a)}else"undefined"!=typeof jQuery?this.robj=jQuery.parseJSON(this.transport.readAll()):this.robj=eval(this.transport.readAll());this.robj instanceof Array==0&&(this.robj=[this.robj]);var r={},version=this.robj.shift();if(version!=Thrift.Protocol.Version)throw"Wrong thrift protocol version: "+version;return r.fname=this.robj.shift(),r.mtype=this.robj.shift(),r.rseqid=this.robj.shift(),this.rstack.push(this.robj.shift()),r},readMessageEnd:function(){},readStructBegin:function(e){var t={fname:""};return this.rstack[this.rstack.length-1]instanceof Array&&this.rstack.push(this.rstack[this.rstack.length-1].shift()),t},readStructEnd:function(){this.rstack[this.rstack.length-2]instanceof Array&&this.rstack.pop()},readFieldBegin:function(){var e={},t=-1,i=Thrift.Type.STOP;for(var n in this.rstack[this.rstack.length-1])if(null!==n){t=parseInt(n,10),this.rpos.push(this.rstack.length);var r=this.rstack[this.rstack.length-1][t];delete this.rstack[this.rstack.length-1][t],this.rstack.push(r);break}if(-1!=t)for(var s in this.rstack[this.rstack.length-1])null!==Thrift.Protocol.RType[s]&&(i=Thrift.Protocol.RType[s],this.rstack[this.rstack.length-1]=this.rstack[this.rstack.length-1][s]);return e.fname="",e.ftype=i,e.fid=t,e},readFieldEnd:function(){for(var e=this.rpos.pop();this.rstack.length>e;)this.rstack.pop()},readMapBegin:function(){var e=this.rstack.pop(),t=e.shift();t instanceof Array&&(this.rstack.push(e),t=(e=t).shift());var i={};return i.ktype=Thrift.Protocol.RType[t],i.vtype=Thrift.Protocol.RType[e.shift()],i.size=e.shift(),this.rpos.push(this.rstack.length),this.rstack.push(e.shift()),i},readMapEnd:function(){this.readFieldEnd()},readListBegin:function(){var e=this.rstack[this.rstack.length-1],t={};return t.etype=Thrift.Protocol.RType[e.shift()],t.size=e.shift(),this.rpos.push(this.rstack.length),this.rstack.push(e.shift()),t},readListEnd:function(){this.readFieldEnd()},readSetBegin:function(e,t){return this.readListBegin(e,t)},readSetEnd:function(){return this.readListEnd()},readBool:function(){var e=this.readI32();return null!==e&&"1"==e.value?e.value=!0:e.value=!1,e},readByte:function(){return this.readI32()},readI16:function(){return this.readI32()},readI32:function(e){void 0===e&&(e=this.rstack[this.rstack.length-1]);var t={};if(e instanceof Array)0===e.length?t.value=void 0:t.value=e.shift();else if(e instanceof Object){for(var i in e)if(null!==i){this.rstack.push(e[i]),delete e[i],t.value=i;break}}else t.value=e,this.rstack.pop();return t},readI64:function(){return this.readI32()},readDouble:function(){return this.readI32()},readString:function(){return this.readI32()},readBinary:function(){var e=this.readI32();return e.value=atob(e.value),e},skip:function(e){var t,i;switch(e){case Thrift.Type.STOP:return null;case Thrift.Type.BOOL:return this.readBool();case Thrift.Type.BYTE:return this.readByte();case Thrift.Type.I16:return this.readI16();case Thrift.Type.I32:return this.readI32();case Thrift.Type.I64:return this.readI64();case Thrift.Type.DOUBLE:return this.readDouble();case Thrift.Type.STRING:return this.readString();case Thrift.Type.STRUCT:for(this.readStructBegin();(t=this.readFieldBegin()).ftype!=Thrift.Type.STOP;)this.skip(t.ftype),this.readFieldEnd();return this.readStructEnd(),null;case Thrift.Type.MAP:for(t=this.readMapBegin(),i=0;i<t.size;i++)i>0&&this.rstack.length>this.rpos[this.rpos.length-1]+1&&this.rstack.pop(),this.skip(t.ktype),this.skip(t.vtype);return this.readMapEnd(),null;case Thrift.Type.SET:for(t=this.readSetBegin(),i=0;i<t.size;i++)this.skip(t.etype);return this.readSetEnd(),null;case Thrift.Type.LIST:for(t=this.readListBegin(),i=0;i<t.size;i++)this.skip(t.etype);return this.readListEnd(),null}}},Thrift.MultiplexProtocol=function(e,t,i,n){Thrift.Protocol.call(this,t,i,n),this.serviceName=e},Thrift.inherits(Thrift.MultiplexProtocol,Thrift.Protocol,"multiplexProtocol"),Thrift.MultiplexProtocol.prototype.writeMessageBegin=function(e,t,i){t===Thrift.MessageType.CALL||t===Thrift.MessageType.ONEWAY?Thrift.Protocol.prototype.writeMessageBegin.call(this,this.serviceName+":"+e,t,i):Thrift.Protocol.prototype.writeMessageBegin.call(this,e,t,i)},Thrift.Multiplexer=function(){this.seqid=0},Thrift.Multiplexer.prototype.createClient=function(e,t,i){t.Client&&(t=t.Client);var n=this;return t.prototype.new_seqid=function(){return n.seqid+=1,n.seqid},new t(new Thrift.MultiplexProtocol(e,i))},_copyList=function(e,t){if(!e)return e;var i,n,r,s=i=void 0===t.shift?t:t[0],a=e.length,o=[];for(n=0;n<a;n++)r=e[n],null===i?o.push(r):i===_copyMap||i===_copyList?o.push(i(r,t.slice(1))):o.push(new s(r));return o},_copyMap=function(e,t){if(!e)return e;var i,n,r=i=void 0===t.shift?t:t[0],s={};for(var a in e)e.hasOwnProperty(a)&&(n=e[a],s[a]=null===i?n:i===_copyMap||i===_copyList?i(n,t.slice(1)):new r(n));return s},Thrift.copyMap=_copyMap,Thrift.copyList=_copyList,__webpack_exports__.default=Thrift},function(e,t,i){var n=i(20),r=i(21),s=i(22),a=i(23);e.exports=function(e){return n(e)||r(e)||s(e)||a()}},function(e,t){function i(e,t,i,n,r,s,a){try{var o=e[s](a),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(n,r)}e.exports=function(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function o(e){i(a,r,s,o,l,"next",e)}function l(e){i(a,r,s,o,l,"throw",e)}o(void 0)}))}}},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){var n=i(8).default,r=i(29),s=r.MiniappSession,a=r.MiniappJoinChooseServer,o=r.MiniappConnectWebSocket,l=r.MiniappJoin,u=r.MiniappPublish,h=r.MiniappUnpublish,c=r.MiniappSubscribe,d=r.MiniappUnsubscribe,p=r.MiniappLeave,f=r.MiniappServerEvent,T=r.MiniappPusherState,v=r.MiniappPlayerState,y=function(e){this.uri=null,this.miniappSession=null,this.miniappJoinChooseServer=null,this.miniappConnectWebSocket=null,this.miniappJoin=null,this.miniappPublish=null,this.miniappUnpublish=null,this.miniappSubscribe=null,this.miniappUnsubscribe=null,this.miniappLeave=null,this.miniappServerEvent=null,this.miniappPusherState=null,this.miniappPlayerState=null,e&&(void 0!==e.uri&&null!==e.uri&&(this.uri=e.uri),void 0!==e.miniappSession&&null!==e.miniappSession&&(this.miniappSession=new s(e.miniappSession)),void 0!==e.miniappJoinChooseServer&&null!==e.miniappJoinChooseServer&&(this.miniappJoinChooseServer=new a(e.miniappJoinChooseServer)),void 0!==e.miniappConnectWebSocket&&null!==e.miniappConnectWebSocket&&(this.miniappConnectWebSocket=new o(e.miniappConnectWebSocket)),void 0!==e.miniappJoin&&null!==e.miniappJoin&&(this.miniappJoin=new l(e.miniappJoin)),void 0!==e.miniappPublish&&null!==e.miniappPublish&&(this.miniappPublish=new u(e.miniappPublish)),void 0!==e.miniappUnpublish&&null!==e.miniappUnpublish&&(this.miniappUnpublish=new h(e.miniappUnpublish)),void 0!==e.miniappSubscribe&&null!==e.miniappSubscribe&&(this.miniappSubscribe=new c(e.miniappSubscribe)),void 0!==e.miniappUnsubscribe&&null!==e.miniappUnsubscribe&&(this.miniappUnsubscribe=new d(e.miniappUnsubscribe)),void 0!==e.miniappLeave&&null!==e.miniappLeave&&(this.miniappLeave=new p(e.miniappLeave)),void 0!==e.miniappServerEvent&&null!==e.miniappServerEvent&&(this.miniappServerEvent=new f(e.miniappServerEvent)),void 0!==e.miniappPusherState&&null!==e.miniappPusherState&&(this.miniappPusherState=new T(e.miniappPusherState)),void 0!==e.miniappPlayerState&&null!==e.miniappPlayerState&&(this.miniappPlayerState=new v(e.miniappPlayerState)))};(y.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),r=t.fid;if(i==n.Type.STOP)break;switch(r){case 1:i==n.Type.I32?this.uri=e.readI32().value:e.skip(i);break;case 8e3:i==n.Type.STRUCT?(this.miniappSession=new s,this.miniappSession.read(e)):e.skip(i);break;case 8001:i==n.Type.STRUCT?(this.miniappJoinChooseServer=new a,this.miniappJoinChooseServer.read(e)):e.skip(i);break;case 8002:i==n.Type.STRUCT?(this.miniappConnectWebSocket=new o,this.miniappConnectWebSocket.read(e)):e.skip(i);break;case 8003:i==n.Type.STRUCT?(this.miniappJoin=new l,this.miniappJoin.read(e)):e.skip(i);break;case 8004:i==n.Type.STRUCT?(this.miniappPublish=new u,this.miniappPublish.read(e)):e.skip(i);break;case 8005:i==n.Type.STRUCT?(this.miniappUnpublish=new h,this.miniappUnpublish.read(e)):e.skip(i);break;case 8006:i==n.Type.STRUCT?(this.miniappSubscribe=new c,this.miniappSubscribe.read(e)):e.skip(i);break;case 8007:i==n.Type.STRUCT?(this.miniappUnsubscribe=new d,this.miniappUnsubscribe.read(e)):e.skip(i);break;case 8008:i==n.Type.STRUCT?(this.miniappLeave=new p,this.miniappLeave.read(e)):e.skip(i);break;case 8009:i==n.Type.STRUCT?(this.miniappServerEvent=new f,this.miniappServerEvent.read(e)):e.skip(i);break;case 8010:i==n.Type.STRUCT?(this.miniappPusherStateEvent=new MiniappPusherStateEvent,this.miniappPusherStateEvent.read(e)):e.skip(i);break;case 8011:i==n.Type.STRUCT?(this.miniappPlayerStateEvent=new MiniappPlayerStateEvent,this.miniappPlayerStateEvent.read(e)):e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},y.prototype.write=function(e){e.writeStructBegin("ReportItem"),null!==this.uri&&void 0!==this.uri&&(e.writeFieldBegin("uri",n.Type.I32,1),e.writeI32(this.uri),e.writeFieldEnd()),null!==this.miniappSession&&void 0!==this.miniappSession&&(e.writeFieldBegin("miniappSession",n.Type.STRUCT,8e3),this.miniappSession.write(e),e.writeFieldEnd()),null!==this.miniappJoinChooseServer&&void 0!==this.miniappJoinChooseServer&&(e.writeFieldBegin("miniappJoinChooseServer",n.Type.STRUCT,8001),this.miniappJoinChooseServer.write(e),e.writeFieldEnd()),null!==this.miniappConnectWebSocket&&void 0!==this.miniappConnectWebSocket&&(e.writeFieldBegin("miniappConnectWebSocket",n.Type.STRUCT,8002),this.miniappConnectWebSocket.write(e),e.writeFieldEnd()),null!==this.miniappJoin&&void 0!==this.miniappJoin&&(e.writeFieldBegin("miniappJoin",n.Type.STRUCT,8003),this.miniappJoin.write(e),e.writeFieldEnd()),null!==this.miniappPublish&&void 0!==this.miniappPublish&&(e.writeFieldBegin("miniappPublish",n.Type.STRUCT,8004),this.miniappPublish.write(e),e.writeFieldEnd()),null!==this.miniappUnpublish&&void 0!==this.miniappUnpublish&&(e.writeFieldBegin("miniappUnpublish",n.Type.STRUCT,8005),this.miniappUnpublish.write(e),e.writeFieldEnd()),null!==this.miniappSubscribe&&void 0!==this.miniappSubscribe&&(e.writeFieldBegin("miniappSubscribe",n.Type.STRUCT,8006),this.miniappSubscribe.write(e),e.writeFieldEnd()),null!==this.miniappUnsubscribe&&void 0!==this.miniappUnsubscribe&&(e.writeFieldBegin("miniappUnsubscribe",n.Type.STRUCT,8007),this.miniappUnsubscribe.write(e),e.writeFieldEnd()),null!==this.miniappLeave&&void 0!==this.miniappLeave&&(e.writeFieldBegin("miniappLeave",n.Type.STRUCT,8008),this.miniappLeave.write(e),e.writeFieldEnd()),null!==this.miniappServerEvent&&void 0!==this.miniappServerEvent&&(e.writeFieldBegin("miniappServerEvent",n.Type.STRUCT,8009),this.miniappServerEvent.write(e),e.writeFieldEnd()),null!==this.miniappPusherStateEvent&&void 0!==this.miniappPusherStateEvent&&(e.writeFieldBegin("miniappPusherStateEvent",n.Type.STRUCT,8010),this.miniappPusherStateEvent.write(e),e.writeFieldEnd()),null!==this.miniappPlayerStateEvent&&void 0!==this.miniappPlayerStateEvent&&(e.writeFieldBegin("miniappPlayerStateEvent",n.Type.STRUCT,8011),this.miniappPlayerStateEvent.write(e),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()},e.exports=y},function(e,t,i){var n=i(8).default,r=function(e){this.sid=null,this.cname=null,this.cid=null,this.lts=null,this.ip=null,this.uid=null,this.success=null,this.elapse=null,this.peer=null,e&&(void 0!==e.sid&&null!==e.sid&&(this.sid=e.sid),void 0!==e.cname&&null!==e.cname&&(this.cname=e.cname),void 0!==e.cid&&null!==e.cid&&(this.cid=e.cid),void 0!==e.lts&&null!==e.lts&&(this.lts=e.lts),void 0!==e.ip&&null!==e.ip&&(this.ip=e.ip),void 0!==e.uid&&null!==e.uid&&(this.uid=e.uid),void 0!==e.success&&null!==e.success&&(this.success=e.success),void 0!==e.elapse&&null!==e.elapse&&(this.elapse=e.elapse),void 0!==e.peer&&null!==e.peer&&(this.peer=e.peer))};(r.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),r=t.fid;if(i==n.Type.STOP)break;switch(r){case 1:i==n.Type.STRING?this.sid=e.readString().value:e.skip(i);break;case 2:i==n.Type.STRING?this.cname=e.readString().value:e.skip(i);break;case 3:i==n.Type.I64?this.cid=e.readI64().value:e.skip(i);break;case 4:i==n.Type.I64?this.lts=e.readI64().value:e.skip(i);break;case 5:i==n.Type.STRING?this.ip=e.readString().value:e.skip(i);break;case 6:i==n.Type.I64?this.uid=e.readI64().value:e.skip(i);break;case 7:i==n.Type.BOOL?this.success=e.readBool().value:e.skip(i);break;case 8:i==n.Type.I64?this.elapse=e.readI64().value:e.skip(i);break;case 9:i==n.Type.I64?this.peer=e.readI64().value:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},r.prototype.write=function(e){e.writeStructBegin("VosdkHeader"),null!==this.sid&&void 0!==this.sid&&(e.writeFieldBegin("sid",n.Type.STRING,1),e.writeString(this.sid),e.writeFieldEnd()),null!==this.cname&&void 0!==this.cname&&(e.writeFieldBegin("cname",n.Type.STRING,2),e.writeString(this.cname),e.writeFieldEnd()),null!==this.cid&&void 0!==this.cid&&(e.writeFieldBegin("cid",n.Type.I64,3),e.writeI64(this.cid),e.writeFieldEnd()),null!==this.lts&&void 0!==this.lts&&(e.writeFieldBegin("lts",n.Type.I64,4),e.writeI64(this.lts),e.writeFieldEnd()),null!==this.ip&&void 0!==this.ip&&(e.writeFieldBegin("ip",n.Type.STRING,5),e.writeString(this.ip),e.writeFieldEnd()),null!==this.uid&&void 0!==this.uid&&(e.writeFieldBegin("uid",n.Type.I64,6),e.writeI64(this.uid),e.writeFieldEnd()),null!==this.success&&void 0!==this.success&&(e.writeFieldBegin("success",n.Type.BOOL,7),e.writeBool(this.success),e.writeFieldEnd()),null!==this.elapse&&void 0!==this.elapse&&(e.writeFieldBegin("elapse",n.Type.I64,8),e.writeI64(this.elapse),e.writeFieldEnd()),null!==this.peer&&void 0!==this.peer&&(e.writeFieldBegin("peer",n.Type.I64,9),e.writeI64(this.peer),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()};var s=function(e){this.name=null,this.lts=null,this.value=null,this.id=null,this.tagErrorCode=null,e&&(void 0!==e.name&&null!==e.name&&(this.name=e.name),void 0!==e.lts&&null!==e.lts&&(this.lts=e.lts),void 0!==e.value&&null!==e.value&&(this.value=e.value),void 0!==e.id&&null!==e.id&&(this.id=e.id),void 0!==e.tagErrorCode&&null!==e.tagErrorCode&&(this.tagErrorCode=e.tagErrorCode))};(s.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),r=t.fid;if(i==n.Type.STOP)break;switch(r){case 1:i==n.Type.STRING?this.name=e.readString().value:e.skip(i);break;case 2:i==n.Type.I64?this.lts=e.readI64().value:e.skip(i);break;case 3:i==n.Type.I32?this.value=e.readI32().value:e.skip(i);break;case 4:i==n.Type.I32?this.id=e.readI32().value:e.skip(i);break;case 5:i==n.Type.I32?this.tagErrorCode=e.readI32().value:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},s.prototype.write=function(e){e.writeStructBegin("VosdkCounterItem"),null!==this.name&&void 0!==this.name&&(e.writeFieldBegin("name",n.Type.STRING,1),e.writeString(this.name),e.writeFieldEnd()),null!==this.lts&&void 0!==this.lts&&(e.writeFieldBegin("lts",n.Type.I64,2),e.writeI64(this.lts),e.writeFieldEnd()),null!==this.value&&void 0!==this.value&&(e.writeFieldBegin("value",n.Type.I32,3),e.writeI32(this.value),e.writeFieldEnd()),null!==this.id&&void 0!==this.id&&(e.writeFieldBegin("id",n.Type.I32,4),e.writeI32(this.id),e.writeFieldEnd()),null!==this.tagErrorCode&&void 0!==this.tagErrorCode&&(e.writeFieldBegin("tagErrorCode",n.Type.I32,5),e.writeI32(this.tagErrorCode),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()};var a=function(e){this.header=null,this.items=null,e&&(void 0!==e.header&&null!==e.header&&(this.header=new r(e.header)),void 0!==e.items&&null!==e.items&&(this.items=n.copyList(e.items,[s])))};(a.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),a=t.fid;if(i==n.Type.STOP)break;switch(a){case 1:i==n.Type.STRUCT?(this.header=new r,this.header.read(e)):e.skip(i);break;case 2:if(i==n.Type.LIST){var o,l;this.items=[];(l=e.readListBegin()).etype,o=l.size;for(var u=0;u<o;++u){var h=null;(h=new s).read(e),this.items.push(h)}e.readListEnd()}else e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},a.prototype.write=function(e){if(e.writeStructBegin("VosdkCounter"),null!==this.header&&void 0!==this.header&&(e.writeFieldBegin("header",n.Type.STRUCT,1),this.header.write(e),e.writeFieldEnd()),null!==this.items&&void 0!==this.items){for(var t in e.writeFieldBegin("items",n.Type.LIST,2),e.writeListBegin(n.Type.STRUCT,this.items.length),this.items)this.items.hasOwnProperty(t)&&(t=this.items[t]).write(e);e.writeListEnd(),e.writeFieldEnd()}e.writeFieldStop(),e.writeStructEnd()},e.exports={VosdkHeader:r,VosdkCounter:a,VosdkCounterItem:s}},function(e,t,i){var n=i(17),r=i(18);e.exports=function(e,t,i){var s=t&&i||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var o=0;o<16;++o)t[s+o]=a[o];return t||r(a)}},function(e,t){function i(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=i=function(e){return typeof e}:e.exports=i=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(t)}e.exports=i},function(e,t){var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var n=new Uint8Array(16);e.exports=function(){return i(n),n}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}},function(e,t){for(var i=[],n=0;n<256;++n)i[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,r=i;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}},function(e,t,i){var n=function(e){"use strict";var t=Object.prototype,i=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function o(e,t,i,n){var r=t&&t.prototype instanceof h?t:h,s=Object.create(r.prototype),a=new m(n||[]);return s._invoke=function(e,t,i){var n="suspendedStart";return function(r,s){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===r)throw s;return R()}for(i.method=r,i.arg=s;;){var a=i.delegate;if(a){var o=S(a,i);if(o){if(o===u)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var h=l(e,t,i);if("normal"===h.type){if(n=i.done?"completed":"suspendedYield",h.arg===u)continue;return{value:h.arg,done:i.done}}"throw"===h.type&&(n="completed",i.method="throw",i.arg=h.arg)}}}(e,i,a),s}function l(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=o;var u={};function h(){}function c(){}function d(){}var p={};p[r]=function(){return this};var f=Object.getPrototypeOf,T=f&&f(f(_([])));T&&T!==t&&i.call(T,r)&&(p=T);var v=d.prototype=h.prototype=Object.create(p);function y(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function E(e,t){var n;this._invoke=function(r,s){function a(){return new t((function(n,a){!function n(r,s,a,o){var u=l(e[r],e,s);if("throw"!==u.type){var h=u.arg,c=h.value;return c&&"object"==typeof c&&i.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,a,o)}),(function(e){n("throw",e,a,o)})):t.resolve(c).then((function(e){h.value=e,a(h)}),(function(e){return n("throw",e,a,o)}))}o(u.arg)}(r,s,n,a)}))}return n=n?n.then(a,a):a()}}function S(e,t){var i=e.iterator[t.method];if(void 0===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var n=l(i,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,u;var r=n.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function g(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function m(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(g,this),this.reset(!0)}function _(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,s=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return s.next=s}}return{next:R}}function R(){return{value:void 0,done:!0}}return c.prototype=v.constructor=d,d.constructor=c,d[a]=c.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===c||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(E.prototype),E.prototype[s]=function(){return this},e.AsyncIterator=E,e.async=function(t,i,n,r,s){void 0===s&&(s=Promise);var a=new E(o(t,i,n,r),s);return e.isGeneratorFunction(i)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(v),v[a]="Generator",v[r]=function(){return this},v.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var n=t.pop();if(n in e)return i.value=n,i.done=!1,i}return i.done=!0,i}},e.values=_,m.prototype={constructor:m,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(i,n){return a.type="throw",a.arg=e,t.next=i,n&&(t.method="next",t.arg=void 0),!!n}for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],a=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var o=i.call(s,"catchLoc"),l=i.call(s,"finallyLoc");if(o&&l){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),w(i),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var r=n.arg;w(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:_(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=n}catch(e){Function("r","regeneratorRuntime = r")(n)}},function(e,t,i){var n=i(11);e.exports=function(e){if(Array.isArray(e))return n(e)}},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},function(e,t,i){var n=i(11);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,i){(function(e){var n=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function s(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new s(r.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new s(r.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},i(25),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,i(12))},function(e,t,i){(function(e,t){!function(e,i){"use strict";if(!e.setImmediate){var n,r,s,a,o,l=1,u={},h=!1,c=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick((function(){f(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,i=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=i,t}}()?e.MessageChannel?((s=new MessageChannel).port1.onmessage=function(e){f(e.data)},n=function(e){s.port2.postMessage(e)}):c&&"onreadystatechange"in c.createElement("script")?(r=c.documentElement,n=function(e){var t=c.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):n=function(e){setTimeout(f,0,e)}:(a="setImmediate$"+Math.random()+"$",o=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&f(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",o,!1):e.attachEvent("onmessage",o),n=function(t){e.postMessage(a+t,"*")}),d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var r={callback:e,args:t};return u[l]=r,n(l),l++},d.clearImmediate=p}function p(e){delete u[e]}function f(e){if(h)setTimeout(f,0,e);else{var t=u[e];if(t){h=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(void 0,i)}}(t)}finally{p(e),h=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,i(12),i(26))},function(e,t){var i,n,r=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(i===setTimeout)return setTimeout(e,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(e){i=s}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var l,u=[],h=!1,c=-1;function d(){h&&l&&(h=!1,l.length?u=l.concat(u):c=-1,u.length&&p())}function p(){if(!h){var e=o(d);h=!0;for(var t=u.length;t;){for(l=u,u=[];++c<t;)l&&l[c].run();c=-1,t=u.length}l=null,h=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function T(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];u.push(new f(e,t)),1!==u.length||h||o(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=T,r.addListener=T,r.once=T,r.off=T,r.removeListener=T,r.removeAllListeners=T,r.emit=T,r.prependListener=T,r.prependOnceListener=T,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,i){var n;
/*!
 * EventEmitter v5.2.9 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */!function(t){"use strict";function r(){}var s=r.prototype,a=t.EventEmitter;function o(e,t){for(var i=e.length;i--;)if(e[i].listener===t)return i;return-1}function l(e){return function(){return this[e].apply(this,arguments)}}s.getListeners=function(e){var t,i,n=this._getEvents();if(e instanceof RegExp)for(i in t={},n)n.hasOwnProperty(i)&&e.test(i)&&(t[i]=n[i]);else t=n[e]||(n[e]=[]);return t},s.flattenListeners=function(e){var t,i=[];for(t=0;t<e.length;t+=1)i.push(e[t].listener);return i},s.getListenersAsObject=function(e){var t,i=this.getListeners(e);return i instanceof Array&&((t={})[e]=i),t||i},s.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var i,n=this.getListenersAsObject(e),r="object"==typeof t;for(i in n)n.hasOwnProperty(i)&&-1===o(n[i],t)&&n[i].push(r?t:{listener:t,once:!1});return this},s.on=l("addListener"),s.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},s.once=l("addOnceListener"),s.defineEvent=function(e){return this.getListeners(e),this},s.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},s.removeListener=function(e,t){var i,n,r=this.getListenersAsObject(e);for(n in r)r.hasOwnProperty(n)&&-1!==(i=o(r[n],t))&&r[n].splice(i,1);return this},s.off=l("removeListener"),s.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},s.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},s.manipulateListeners=function(e,t,i){var n,r,s=e?this.removeListener:this.addListener,a=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=i.length;n--;)s.call(this,t,i[n]);else for(n in t)t.hasOwnProperty(n)&&(r=t[n])&&("function"==typeof r?s.call(this,n,r):a.call(this,n,r));return this},s.removeEvent=function(e){var t,i=typeof e,n=this._getEvents();if("string"===i)delete n[e];else if(e instanceof RegExp)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},s.removeAllListeners=l("removeEvent"),s.emitEvent=function(e,t){var i,n,r,s,a=this.getListenersAsObject(e);for(s in a)if(a.hasOwnProperty(s))for(i=a[s].slice(0),r=0;r<i.length;r++)!0===(n=i[r]).once&&this.removeListener(e,n.listener),n.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},s.trigger=l("emitEvent"),s.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},s.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},s._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},s._getEvents=function(){return this._events||(this._events={})},r.noConflict=function(){return t.EventEmitter=a,r},void 0===(n=function(){return r}.call(t,i,t,e))||(e.exports=n)}("undefined"!=typeof window?window:this||{})},function(e,t,i){var n=i(8).default,r=i(13),s=function(e){this.item=null,e&&void 0!==e.item&&null!==e.item&&(this.item=new r(e.item))};(s.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),s=t.fid;if(i==n.Type.STOP)break;switch(s){case 1:i==n.Type.STRUCT?(this.item=new r,this.item.read(e)):e.skip(i);break;case 0:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},s.prototype.write=function(e){e.writeStructBegin("ReportService_Report_args"),null!==this.item&&void 0!==this.item&&(e.writeFieldBegin("item",n.Type.STRUCT,1),this.item.write(e),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()};var a=function(e){};(a.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype);t.fid;if(i==n.Type.STOP)break;e.skip(i),e.readFieldEnd()}e.readStructEnd()},a.prototype.write=function(e){e.writeStructBegin("ReportService_Report_result"),e.writeFieldStop(),e.writeStructEnd()};var o=function(e,t){this.input=e,this.output=t||e,this.seqid=0};(o.prototype={}).Report=function(e,t){this.send_Report(e,t),t||this.recv_Report()},o.prototype.send_Report=function(e,t){if(this.output.writeMessageBegin("Report",n.MessageType.CALL,this.seqid),new s({item:e}).write(this.output),this.output.writeMessageEnd(),!t)return this.output.getTransport().flush();this.output.getTransport().flush(!0,(function(e){t(e)}))},o.prototype.recv_Report=function(){var e=this.input.readMessageBegin(),t=(e.fname,e.mtype);e.rseqid;if(t==n.MessageType.EXCEPTION){var i=new n.TApplicationException;throw i.read(this.input),this.input.readMessageEnd(),i}(new a).read(this.input),this.input.readMessageEnd()},e.exports={ReportService_Report_args:s,ReportService_Report_result:a,ReportServiceClient:o}},function(e,t,i){var n=i(8).default,r=i(14).VosdkHeader,s=function(e){this.header=null,this.appid=null,this.uname=null,this.ver=null,this.dk=null,this.details=null,e&&(void 0!==e.header&&null!==e.header&&(this.header=new r(e.header)),void 0!==e.appid&&null!==e.appid&&(this.appid=e.appid),void 0!==e.uname&&null!==e.uname&&(this.uname=e.uname),void 0!==e.ver&&null!==e.ver&&(this.ver=e.ver),void 0!==e.dk&&null!==e.dk&&(this.dk=e.dk),void 0!==e.details&&null!==e.details&&(this.details=e.details))};(s.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),s=t.fid;if(i==n.Type.STOP)break;switch(s){case 1:i==n.Type.STRUCT?(this.header=new r,this.header.read(e)):e.skip(i);break;case 2:i==n.Type.STRING?this.appid=e.readString().value:e.skip(i);break;case 3:i==n.Type.STRING?this.uname=e.readString().value:e.skip(i);break;case 4:i==n.Type.STRING?this.ver=e.readString().value:e.skip(i);break;case 5:i==n.Type.STRING?this.dk=e.readString().value:e.skip(i);break;case 6:i==n.Type.STRING?this.details=e.readString().value:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},s.prototype.write=function(e){e.writeStructBegin("MiniappSession"),null!==this.header&&void 0!==this.header&&(e.writeFieldBegin("header",n.Type.STRUCT,1),this.header.write(e),e.writeFieldEnd()),null!==this.appid&&void 0!==this.appid&&(e.writeFieldBegin("appid",n.Type.STRING,2),e.writeString(this.appid),e.writeFieldEnd()),null!==this.uname&&void 0!==this.uname&&(e.writeFieldBegin("uname",n.Type.STRING,3),e.writeString(this.uname),e.writeFieldEnd()),null!==this.ver&&void 0!==this.ver&&(e.writeFieldBegin("ver",n.Type.STRING,4),e.writeString(this.ver),e.writeFieldEnd()),null!==this.dk&&void 0!==this.dk&&(e.writeFieldBegin("dk",n.Type.STRING,5),e.writeString(this.dk),e.writeFieldEnd()),null!==this.details&&void 0!==this.details&&(e.writeFieldBegin("details",n.Type.STRING,6),e.writeString(this.details),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()};var a=function(e){this.header=null,this.csurl=null,this.ec=null,this.gatewaylist=null,this.details=null,e&&(void 0!==e.header&&null!==e.header&&(this.header=new r(e.header)),void 0!==e.csurl&&null!==e.csurl&&(this.csurl=e.csurl),void 0!==e.ec&&null!==e.ec&&(this.ec=e.ec),void 0!==e.gatewaylist&&null!==e.gatewaylist&&(this.gatewaylist=n.copyList(e.gatewaylist,[null])),void 0!==e.details&&null!==e.details&&(this.details=e.details))};(a.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),s=t.fid;if(i==n.Type.STOP)break;switch(s){case 1:i==n.Type.STRUCT?(this.header=new r,this.header.read(e)):e.skip(i);break;case 2:i==n.Type.STRING?this.csurl=e.readString().value:e.skip(i);break;case 3:i==n.Type.STRING?this.ec=e.readString().value:e.skip(i);break;case 4:if(i==n.Type.LIST){var a,o;this.gatewaylist=[];(o=e.readListBegin()).etype,a=o.size;for(var l=0;l<a;++l){var u;u=e.readString().value,this.gatewaylist.push(u)}e.readListEnd()}else e.skip(i);break;case 5:i==n.Type.STRING?this.details=e.readString().value:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},a.prototype.write=function(e){if(e.writeStructBegin("MiniappJoinChooseServer"),null!==this.header&&void 0!==this.header&&(e.writeFieldBegin("header",n.Type.STRUCT,1),this.header.write(e),e.writeFieldEnd()),null!==this.csurl&&void 0!==this.csurl&&(e.writeFieldBegin("csurl",n.Type.STRING,2),e.writeString(this.csurl),e.writeFieldEnd()),null!==this.ec&&void 0!==this.ec&&(e.writeFieldBegin("ec",n.Type.STRING,3),e.writeString(this.ec),e.writeFieldEnd()),null!==this.gatewaylist&&void 0!==this.gatewaylist){for(var t in e.writeFieldBegin("gatewaylist",n.Type.LIST,4),e.writeListBegin(n.Type.STRING,this.gatewaylist.length),this.gatewaylist)this.gatewaylist.hasOwnProperty(t)&&(t=this.gatewaylist[t],e.writeString(t));e.writeListEnd(),e.writeFieldEnd()}null!==this.details&&void 0!==this.details&&(e.writeFieldBegin("details",n.Type.STRING,5),e.writeString(this.details),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()};var o=function(e){this.header=null,this.gateway=null,this.ec=null,this.wsurl=null,this.details=null,e&&(void 0!==e.header&&null!==e.header&&(this.header=new r(e.header)),void 0!==e.gateway&&null!==e.gateway&&(this.gateway=e.gateway),void 0!==e.ec&&null!==e.ec&&(this.ec=e.ec),void 0!==e.wsurl&&null!==e.wsurl&&(this.wsurl=e.wsurl),void 0!==e.details&&null!==e.details&&(this.details=e.details))};(o.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),s=t.fid;if(i==n.Type.STOP)break;switch(s){case 1:i==n.Type.STRUCT?(this.header=new r,this.header.read(e)):e.skip(i);break;case 2:i==n.Type.STRING?this.gateway=e.readString().value:e.skip(i);break;case 3:i==n.Type.STRING?this.ec=e.readString().value:e.skip(i);break;case 4:i==n.Type.STRING?this.wsurl=e.readString().value:e.skip(i);break;case 5:i==n.Type.STRING?this.details=e.readString().value:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},o.prototype.write=function(e){e.writeStructBegin("MiniappConnectWebSocket"),null!==this.header&&void 0!==this.header&&(e.writeFieldBegin("header",n.Type.STRUCT,1),this.header.write(e),e.writeFieldEnd()),null!==this.gateway&&void 0!==this.gateway&&(e.writeFieldBegin("gateway",n.Type.STRING,2),e.writeString(this.gateway),e.writeFieldEnd()),null!==this.ec&&void 0!==this.ec&&(e.writeFieldBegin("ec",n.Type.STRING,3),e.writeString(this.ec),e.writeFieldEnd()),null!==this.wsurl&&void 0!==this.wsurl&&(e.writeFieldBegin("wsurl",n.Type.STRING,4),e.writeString(this.wsurl),e.writeFieldEnd()),null!==this.details&&void 0!==this.details&&(e.writeFieldBegin("details",n.Type.STRING,5),e.writeString(this.details),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()};var l=function(e){this.header=null,this.uid=null,this.ec=null,this.isrejoin=null,this.details=null,e&&(void 0!==e.header&&null!==e.header&&(this.header=new r(e.header)),void 0!==e.uid&&null!==e.uid&&(this.uid=e.uid),void 0!==e.ec&&null!==e.ec&&(this.ec=e.ec),void 0!==e.isrejoin&&null!==e.isrejoin&&(this.isrejoin=e.isrejoin),void 0!==e.details&&null!==e.details&&(this.details=e.details))};(l.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),s=t.fid;if(i==n.Type.STOP)break;switch(s){case 1:i==n.Type.STRUCT?(this.header=new r,this.header.read(e)):e.skip(i);break;case 2:i==n.Type.STRING?this.uid=e.readString().value:e.skip(i);break;case 3:i==n.Type.STRING?this.ec=e.readString().value:e.skip(i);break;case 4:i==n.Type.BOOL?this.isrejoin=e.readBool().value:e.skip(i);break;case 5:i==n.Type.STRING?this.details=e.readString().value:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},l.prototype.write=function(e){e.writeStructBegin("MiniappJoin"),null!==this.header&&void 0!==this.header&&(e.writeFieldBegin("header",n.Type.STRUCT,1),this.header.write(e),e.writeFieldEnd()),null!==this.uid&&void 0!==this.uid&&(e.writeFieldBegin("uid",n.Type.STRING,2),e.writeString(this.uid),e.writeFieldEnd()),null!==this.ec&&void 0!==this.ec&&(e.writeFieldBegin("ec",n.Type.STRING,3),e.writeString(this.ec),e.writeFieldEnd()),null!==this.isrejoin&&void 0!==this.isrejoin&&(e.writeFieldBegin("isrejoin",n.Type.BOOL,4),e.writeBool(this.isrejoin),e.writeFieldEnd()),null!==this.details&&void 0!==this.details&&(e.writeFieldBegin("details",n.Type.STRING,5),e.writeString(this.details),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()};var u=function(e){this.header=null,this.ec=null,this.pushurl=null,this.uid=null,this.details=null,e&&(void 0!==e.header&&null!==e.header&&(this.header=new r(e.header)),void 0!==e.ec&&null!==e.ec&&(this.ec=e.ec),void 0!==e.pushurl&&null!==e.pushurl&&(this.pushurl=e.pushurl),void 0!==e.uid&&null!==e.uid&&(this.uid=e.uid),void 0!==e.details&&null!==e.details&&(this.details=e.details))};(u.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),s=t.fid;if(i==n.Type.STOP)break;switch(s){case 1:i==n.Type.STRUCT?(this.header=new r,this.header.read(e)):e.skip(i);break;case 2:i==n.Type.STRING?this.ec=e.readString().value:e.skip(i);break;case 3:i==n.Type.STRING?this.pushurl=e.readString().value:e.skip(i);break;case 4:i==n.Type.STRING?this.uid=e.readString().value:e.skip(i);break;case 5:i==n.Type.STRING?this.details=e.readString().value:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},u.prototype.write=function(e){e.writeStructBegin("MiniappPublish"),null!==this.header&&void 0!==this.header&&(e.writeFieldBegin("header",n.Type.STRUCT,1),this.header.write(e),e.writeFieldEnd()),null!==this.ec&&void 0!==this.ec&&(e.writeFieldBegin("ec",n.Type.STRING,2),e.writeString(this.ec),e.writeFieldEnd()),null!==this.pushurl&&void 0!==this.pushurl&&(e.writeFieldBegin("pushurl",n.Type.STRING,3),e.writeString(this.pushurl),e.writeFieldEnd()),null!==this.uid&&void 0!==this.uid&&(e.writeFieldBegin("uid",n.Type.STRING,4),e.writeString(this.uid),e.writeFieldEnd()),null!==this.details&&void 0!==this.details&&(e.writeFieldBegin("details",n.Type.STRING,5),e.writeString(this.details),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()};var h=function(e){this.header=null,this.ec=null,this.uid=null,this.details=null,e&&(void 0!==e.header&&null!==e.header&&(this.header=new r(e.header)),void 0!==e.ec&&null!==e.ec&&(this.ec=e.ec),void 0!==e.uid&&null!==e.uid&&(this.uid=e.uid),void 0!==e.details&&null!==e.details&&(this.details=e.details))};(h.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),s=t.fid;if(i==n.Type.STOP)break;switch(s){case 1:i==n.Type.STRUCT?(this.header=new r,this.header.read(e)):e.skip(i);break;case 2:i==n.Type.STRING?this.ec=e.readString().value:e.skip(i);break;case 3:i==n.Type.STRING?this.uid=e.readString().value:e.skip(i);break;case 5:i==n.Type.STRING?this.details=e.readString().value:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},h.prototype.write=function(e){e.writeStructBegin("MiniappUnpublish"),null!==this.header&&void 0!==this.header&&(e.writeFieldBegin("header",n.Type.STRUCT,1),this.header.write(e),e.writeFieldEnd()),null!==this.ec&&void 0!==this.ec&&(e.writeFieldBegin("ec",n.Type.STRING,2),e.writeString(this.ec),e.writeFieldEnd()),null!==this.uid&&void 0!==this.uid&&(e.writeFieldBegin("uid",n.Type.STRING,3),e.writeString(this.uid),e.writeFieldEnd()),null!==this.details&&void 0!==this.details&&(e.writeFieldBegin("details",n.Type.STRING,5),e.writeString(this.details),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()};var c=function(e){this.header=null,this.ec=null,this.pullurl=null,this.peerid=null,this.details=null,e&&(void 0!==e.header&&null!==e.header&&(this.header=new r(e.header)),void 0!==e.ec&&null!==e.ec&&(this.ec=e.ec),void 0!==e.pullurl&&null!==e.pullurl&&(this.pullurl=e.pullurl),void 0!==e.peerid&&null!==e.peerid&&(this.peerid=e.peerid),void 0!==e.details&&null!==e.details&&(this.details=e.details))};(c.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),s=t.fid;if(i==n.Type.STOP)break;switch(s){case 1:i==n.Type.STRUCT?(this.header=new r,this.header.read(e)):e.skip(i);break;case 2:i==n.Type.STRING?this.ec=e.readString().value:e.skip(i);break;case 3:i==n.Type.STRING?this.pullurl=e.readString().value:e.skip(i);break;case 4:i==n.Type.STRING?this.peerid=e.readString().value:e.skip(i);break;case 5:i==n.Type.STRING?this.details=e.readString().value:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},c.prototype.write=function(e){e.writeStructBegin("MiniappSubscribe"),null!==this.header&&void 0!==this.header&&(e.writeFieldBegin("header",n.Type.STRUCT,1),this.header.write(e),e.writeFieldEnd()),null!==this.ec&&void 0!==this.ec&&(e.writeFieldBegin("ec",n.Type.STRING,2),e.writeString(this.ec),e.writeFieldEnd()),null!==this.pullurl&&void 0!==this.pullurl&&(e.writeFieldBegin("pullurl",n.Type.STRING,3),e.writeString(this.pullurl),e.writeFieldEnd()),null!==this.peerid&&void 0!==this.peerid&&(e.writeFieldBegin("peerid",n.Type.STRING,4),e.writeString(this.peerid),e.writeFieldEnd()),null!==this.details&&void 0!==this.details&&(e.writeFieldBegin("details",n.Type.STRING,5),e.writeString(this.details),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()};var d=function(e){this.header=null,this.ec=null,this.peerid=null,this.details=null,e&&(void 0!==e.header&&null!==e.header&&(this.header=new r(e.header)),void 0!==e.ec&&null!==e.ec&&(this.ec=e.ec),void 0!==e.peerid&&null!==e.peerid&&(this.peerid=e.peerid),void 0!==e.details&&null!==e.details&&(this.details=e.details))};(d.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),s=t.fid;if(i==n.Type.STOP)break;switch(s){case 1:i==n.Type.STRUCT?(this.header=new r,this.header.read(e)):e.skip(i);break;case 2:i==n.Type.STRING?this.ec=e.readString().value:e.skip(i);break;case 3:i==n.Type.STRING?this.peerid=e.readString().value:e.skip(i);break;case 4:i==n.Type.STRING?this.details=e.readString().value:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},d.prototype.write=function(e){e.writeStructBegin("MiniappUnsubscribe"),null!==this.header&&void 0!==this.header&&(e.writeFieldBegin("header",n.Type.STRUCT,1),this.header.write(e),e.writeFieldEnd()),null!==this.ec&&void 0!==this.ec&&(e.writeFieldBegin("ec",n.Type.STRING,2),e.writeString(this.ec),e.writeFieldEnd()),null!==this.peerid&&void 0!==this.peerid&&(e.writeFieldBegin("peerid",n.Type.STRING,3),e.writeString(this.peerid),e.writeFieldEnd()),null!==this.details&&void 0!==this.details&&(e.writeFieldBegin("details",n.Type.STRING,4),e.writeString(this.details),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()};var p=function(e){this.header=null,this.uid=null,this.details=null,e&&(void 0!==e.header&&null!==e.header&&(this.header=new r(e.header)),void 0!==e.uid&&null!==e.uid&&(this.uid=e.uid),void 0!==e.details&&null!==e.details&&(this.details=e.details))};(p.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),s=t.fid;if(i==n.Type.STOP)break;switch(s){case 1:i==n.Type.STRUCT?(this.header=new r,this.header.read(e)):e.skip(i);break;case 2:i==n.Type.STRING?this.uid=e.readString().value:e.skip(i);break;case 3:i==n.Type.STRING?this.details=e.readString().value:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},p.prototype.write=function(e){e.writeStructBegin("MiniappLeave"),null!==this.header&&void 0!==this.header&&(e.writeFieldBegin("header",n.Type.STRUCT,1),this.header.write(e),e.writeFieldEnd()),null!==this.uid&&void 0!==this.uid&&(e.writeFieldBegin("uid",n.Type.STRING,2),e.writeString(this.uid),e.writeFieldEnd()),null!==this.details&&void 0!==this.details&&(e.writeFieldBegin("details",n.Type.STRING,3),e.writeString(this.details),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()};var f=function(e){this.header=null,this.action=null,this.details=null,this.req_ts=null,e&&(void 0!==e.header&&null!==e.header&&(this.header=new r(e.header)),void 0!==e.action&&null!==e.action&&(this.action=e.action),void 0!==e.details&&null!==e.details&&(this.details=e.details),void 0!==e.req_ts&&null!==e.req_ts&&(this.req_ts=e.req_ts))};(f.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),s=t.fid;if(i==n.Type.STOP)break;switch(s){case 1:i==n.Type.STRUCT?(this.header=new r,this.header.read(e)):e.skip(i);break;case 2:i==n.Type.STRING?this.action=e.readString().value:e.skip(i);break;case 3:i==n.Type.STRING?this.details=e.readString().value:e.skip(i);break;case 4:i==n.Type.I64?this.req_ts=e.readI64().value:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},f.prototype.write=function(e){e.writeStructBegin("MiniappServerEvent"),null!==this.header&&void 0!==this.header&&(e.writeFieldBegin("header",n.Type.STRUCT,1),this.header.write(e),e.writeFieldEnd()),null!==this.action&&void 0!==this.action&&(e.writeFieldBegin("action",n.Type.STRING,2),e.writeString(this.action),e.writeFieldEnd()),null!==this.details&&void 0!==this.details&&(e.writeFieldBegin("details",n.Type.STRING,3),e.writeString(this.details),e.writeFieldEnd()),null!==this.req_ts&&void 0!==this.req_ts&&(e.writeFieldBegin("req_ts",n.Type.I64,4),e.writeI64(this.req_ts),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()};var T=function(e){this.header=null,this.url=null,this.code=null,this.status=null,this.error=null,this.details=null,e&&(void 0!==e.header&&null!==e.header&&(this.header=new r(e.header)),void 0!==e.url&&null!==e.url&&(this.url=e.url),void 0!==e.code&&null!==e.code&&(this.code=e.code),void 0!==e.status&&null!==e.status&&(this.status=e.status),void 0!==e.error&&null!==e.error&&(this.error=e.error),void 0!==e.details&&null!==e.details&&(this.details=e.details))};(T.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),s=t.fid;if(i==n.Type.STOP)break;switch(s){case 1:i==n.Type.STRUCT?(this.header=new r,this.header.read(e)):e.skip(i);break;case 2:i==n.Type.STRING?this.url=e.readString().value:e.skip(i);break;case 3:i==n.Type.STRING?this.code=e.readString().value:e.skip(i);break;case 4:i==n.Type.STRING?this.status=e.readString().value:e.skip(i);break;case 5:i==n.Type.STRING?this.error=e.readString().value:e.skip(i);break;case 6:i==n.Type.STRING?this.details=e.readString().value:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},T.prototype.write=function(e){e.writeStructBegin("MiniappPusherState"),null!==this.header&&void 0!==this.header&&(e.writeFieldBegin("header",n.Type.STRUCT,1),this.header.write(e),e.writeFieldEnd()),null!==this.url&&void 0!==this.url&&(e.writeFieldBegin("url",n.Type.STRING,2),e.writeString(this.url),e.writeFieldEnd()),null!==this.code&&void 0!==this.code&&(e.writeFieldBegin("code",n.Type.STRING,3),e.writeString(this.code),e.writeFieldEnd()),null!==this.status&&void 0!==this.status&&(e.writeFieldBegin("status",n.Type.STRING,4),e.writeString(this.status),e.writeFieldEnd()),null!==this.error&&void 0!==this.error&&(e.writeFieldBegin("error",n.Type.STRING,5),e.writeString(this.error),e.writeFieldEnd()),null!==this.details&&void 0!==this.details&&(e.writeFieldBegin("details",n.Type.STRING,6),e.writeString(this.details),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()};var v=function(e){this.header=null,this.url=null,this.code=null,this.status=null,this.error=null,this.details=null,e&&(void 0!==e.header&&null!==e.header&&(this.header=new r(e.header)),void 0!==e.url&&null!==e.url&&(this.url=e.url),void 0!==e.code&&null!==e.code&&(this.code=e.code),void 0!==e.status&&null!==e.status&&(this.status=e.status),void 0!==e.error&&null!==e.error&&(this.error=e.error),void 0!==e.details&&null!==e.details&&(this.details=e.details))};(v.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),i=(t.fname,t.ftype),s=t.fid;if(i==n.Type.STOP)break;switch(s){case 1:i==n.Type.STRUCT?(this.header=new r,this.header.read(e)):e.skip(i);break;case 2:i==n.Type.STRING?this.url=e.readString().value:e.skip(i);break;case 3:i==n.Type.STRING?this.code=e.readString().value:e.skip(i);break;case 4:i==n.Type.STRING?this.status=e.readString().value:e.skip(i);break;case 5:i==n.Type.STRING?this.error=e.readString().value:e.skip(i);break;case 6:i==n.Type.STRING?this.details=e.readString().value:e.skip(i);break;default:e.skip(i)}e.readFieldEnd()}e.readStructEnd()},v.prototype.write=function(e){e.writeStructBegin("MiniappPlayerState"),null!==this.header&&void 0!==this.header&&(e.writeFieldBegin("header",n.Type.STRUCT,1),this.header.write(e),e.writeFieldEnd()),null!==this.url&&void 0!==this.url&&(e.writeFieldBegin("url",n.Type.STRING,2),e.writeString(this.url),e.writeFieldEnd()),null!==this.code&&void 0!==this.code&&(e.writeFieldBegin("code",n.Type.STRING,3),e.writeString(this.code),e.writeFieldEnd()),null!==this.status&&void 0!==this.status&&(e.writeFieldBegin("status",n.Type.STRING,4),e.writeString(this.status),e.writeFieldEnd()),null!==this.error&&void 0!==this.error&&(e.writeFieldBegin("error",n.Type.STRING,5),e.writeString(this.error),e.writeFieldEnd()),null!==this.details&&void 0!==this.details&&(e.writeFieldBegin("details",n.Type.STRING,6),e.writeString(this.details),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()},e.exports={MiniappSession:s,MiniappJoinChooseServer:a,MiniappConnectWebSocket:o,MiniappJoin:l,MiniappPublish:u,MiniappUnpublish:h,MiniappSubscribe:c,MiniappUnsubscribe:d,MiniappLeave:p,MiniappServerEvent:f,MiniappPusherState:T,MiniappPlayerState:v}},function(e,t,i){"use strict";i.r(t),i.d(t,"Client",(function(){return C})),i.d(t,"LOG",(function(){return p.default})),i.d(t,"Log",(function(){return p.Log})),i.d(t,"ChannelMediaRelayConfiguration",(function(){return S.ChannelMediaRelayConfiguration})),i.d(t,"SDK_VERSION",(function(){return l.SDK_VERSION}));var n=i(4),r=i.n(n),s=i(5),a=i.n(s),o=i(3),l=i(6),u=i(7),h=i.n(u),c=i(10),d=i.n(c),p=i(1);var f=function(e){return e=e||Object.create(null),{on:function(t,i){(e[t]||(e[t]=[])).push(i)},off:function(t,i){e[t]&&e[t].splice(e[t].indexOf(i)>>>0,1)},emit:function(t,i){(e[t]||[]).slice().map((function(e){e(i)})),(e["*"]||[]).slice().map((function(e){e(t,i)}))}}},T=(i(24),["https://miniapp-1.agoraio.cn/appcenter/1-1-1/getWorkerManager/","https://miniapp-2.agoraio.cn/appcenter/1-1-1/getWorkerManager/","https://miniapp-3.agoraio.cn/appcenter/1-1-1/getWorkerManager/","https://miniapp-4.agoraio.cn/appcenter/1-1-1/getWorkerManager/"]),v=function(e){var t=e.reportManager,i={command:"convergeAllocateEdge",sid:e.sid,appId:e.appId,token:e.appId,uid:e.uid+"",cname:e.channel,ts:Math.floor(Date.now()/1e3),version:l.VERSION,seq:0,requestId:1};return new Promise((function(n,r){var s=0,a=function(i,n){try{t.report("chooseServer",{header:{sid:e.sid,cname:e.channel,uid:e.uid,success:!1},body:{csurl:n,ec:JSON.stringify(i)}})}catch(e){}4===++s&&r(i)};T.map((function(r,s){var o;o=T[s],wx.request({url:o,data:i,header:{"content-type":"application/json"},method:"POST",success:function(i){var r=i.data;if(p.default.debug("From choose server",i),200!==r.code)a({code:901,reason:r.error||"choose server fail"},o);else{var s=function(e){return e.map((function(e){var t=(e=e.address).split("."),i=t.length;return"wss://miniapp.agoraio.cn/".concat(t[i-4],"-").concat(t[i-3],"-").concat(t[i-2],"-").concat(t[i-1],"/api")}))}(r.servers);t.report("chooseServer",{header:{sid:e.sid,cname:e.channel,uid:e.uid,success:!0},body:{csurl:o,gatewaylist:s}}),n({serverlist:s,url:o})}},fail:function(e){a({code:901,reason:e.errMsg||"choose server fail"},o)}})}))}))},y=function(){function e(t,i){r()(this,e),this.serverlist=[],this.option=t,this.index=0,this.isInit=!0,this.state="disconnected",this.hasInvokeClose=!1,this.emitter=i,this.on=this.emitter.on,this.off=this.emitter.off,this.emit=this.emitter.emit}return a()(e,[{key:"connect",value:function(){var e=this;"disconnected"!==this.state&&this.close(),v(this.option).then((function(t){var i=t.serverlist,n=t.url;p.default.debug("Get server list from "+n),e.index=0,e.serverlist=i,e.option&&e.option.servers&&(e.serverlist=e.option.servers),p.default.debug("Connect server with list: ",e.serverlist),e.connectWorker(e.serverlist[e.index])})).catch((function(t){e.emit&&e.emit("socketError",t)}))}},{key:"connectWorker",value:function(){var e=this;this.state="connecting";var t=this.serverlist[this.index];p.default.debug("Connect server: ",t);var i=this.option,n=i.sid,r=i.channel,s=i.uid,a=i.reportManager;this.ws=new wx.connectSocket({url:t,complete:function(e){return p.default.debug("wxSocket: complete: ",e)},fail:function(e){p.default.debug("wxSocket: fail: ",e),a&&a.report("connectWebSocket",{header:{sid:n,cname:r,uid:s,success:!1},body:{wsurl:t,ec:JSON.stringify(e)}})},success:function(e){p.default.debug("wxSocket success: ",e),a&&a.report("connectWebSocket",{header:{sid:n,cname:r,uid:s,success:!0},body:{wsurl:t}})}}),this.ws.onOpen(this._onopen.bind(this)),this.ws.onMessage(this._onmessage.bind(this)),this.establishWSTimeoutTimer=setTimeout((function(){"connected"!==e.state&&e.connectNextWorker()}),5e3)}},{key:"connectNextWorker",value:function(){"disconnected"!==this.state&&this.close(),p.default.debug(this.index,this.serverlist.length),this.index>=this.serverlist.length-1?this.emit&&this.emit("socketError",{code:905,reason:"connect websocket failed",wsurl:JSON.stringify(this.serverlist)}):(this.index++,this.connectWorker())}},{key:"_onopen",value:function(){p.default.info("websocket onopen"),clearTimeout(this.establishWSTimeoutTimer),this.state="connected",this.isInit=!1,this.hasInvokeClose?p.default.debug("Alread invoke ws.Close, will not throw onopen event"):(this.ws.onClose(this._onclose.bind(this)),this.emit&&this.emit("onopen"))}},{key:"_onclose",value:function(e){p.default.info("websocket onclose:"+JSON.stringify(e)),this.emitter.emit("_wsClose"),clearTimeout(this.establishWSTimeoutTimer),this.state="disconnected",e&&"close"==e.reason||this.hasInvokeClose||(this.isInit?this.connectNextWorker():this.emit&&this.emit("onclose"))}},{key:"_onmessage",value:function(e){this.hasInvokeClose||(p.default.blind("receive message: ",JSON.stringify(e)),this.isConnected()&&this.emit&&this.emit("onmessage",e))}},{key:"isConnected",value:function(){return"connected"===this.state}},{key:"sendMessage",value:function(e){p.default.blind("send message: ",e),this.isConnected()&&this.ws&&this.ws.send({data:e})}},{key:"_checkServerList",value:function(e){return e instanceof Array!=0&&0!=e.length}},{key:"destroy",value:function(e){var t=this;"disconnected"!==this.state&&this.close();this.on("_wsClose",(function i(){t.off("_wsClose",i),t.serverlist=null,t.ws=null,t.emitter=null,t.on=null,t.off=null,t.emit=null,e&&e()}))}},{key:"close",value:function(){p.default.debug("Close websocket"),clearTimeout(this.establishWSTimeoutTimer),this.hasInvokeClose=!0,this.state="disconnected",this.ws&&this.ws.close({reason:"close"}),this.ws=null}}]),e}(),E=function(){function e(t){r()(this,e),this.appId=t.appId,this.channel=t.channel,this.uid=t.uid+"",this.sid=t.sid,this.seq=1,this.requestId=2}return a()(e,[{key:"setSid",value:function(e){this.sid=e}},{key:"_getWorkerManagerMsg",value:function(){return{appId:this.appId,cname:this.channel,uid:this.uid,sid:this.sid,sdkVersion:l.VERSION,seq:++this.seq,requestId:++this.requestId,ts:Math.floor(Date.now()/1e3)}}},{key:"send",value:function(e){var t=this._getWorkerManagerMsg();return t.clientRequest=e,t}},{key:"updatePushUrl",value:function(){var e=this._getWorkerManagerMsg();return e.clientRequest={action:"update_url",role:"publish",uid:+this.uid},e}},{key:"ping",value:function(){return{command:"ping",requestId:++this.requestId,appId:this.appId,cname:this.channel,uid:this.uid+"",sid:this.sid,ts:Math.floor(Date.now()/1e3)}}},{key:"ping2",value:function(){var e=this._getWorkerManagerMsg();return e.clientRequest={action:"ping"},e}},{key:"setRole",value:function(e){var t=this._getWorkerManagerMsg();return t.clientRequest={action:"set_role",role:e},t}},{key:"rejoin",value:function(e,t,i,n,r,s){var a=this._getWorkerManagerMsg();return a.clientRequest={action:"join",role:s,appId:e,key_vocs:n||e,key_vos:n||e,channel_name:t,uid:i+"",known_speakers:r,clientType:"undefined"==typeof qq?"wechat":"qq"},a}},{key:"join",value:function(e,t,i,n,r){var s=this._getWorkerManagerMsg();return s.clientRequest={action:"join",role:r,appId:e,key_vocs:n||e,key_vos:n||e,channel_name:t,uid:i+"",clientType:"undefined"==typeof qq?"wechat":"qq"},s}},{key:"muteLocal",value:function(e,t){var i=this._getWorkerManagerMsg();return i.clientRequest={action:"mute_local",uid:+e,target:t,mute:!0},i}},{key:"unmuteLocal",value:function(e,t){var i=this._getWorkerManagerMsg();return i.clientRequest={action:"mute_local",uid:+e,target:t,mute:!1},i}},{key:"mute",value:function(e,t){var i=this._getWorkerManagerMsg();return i.clientRequest={action:"mute",uid:+e,target:t},i}},{key:"unmute",value:function(e,t){var i=this._getWorkerManagerMsg();return i.clientRequest={action:"unmute",uid:+e,target:t},i}},{key:"publish",value:function(e){var t=this._getWorkerManagerMsg();return t.clientRequest={action:"publish",uid:+e},t}},{key:"unpublish",value:function(e){var t=this._getWorkerManagerMsg();return t.clientRequest={action:"unpublish",uid:+e},t}},{key:"subscribe",value:function(e){var t=this._getWorkerManagerMsg();return t.clientRequest={action:"subscribe",uid:+e},t}},{key:"unsubscribe",value:function(e){var t=this._getWorkerManagerMsg();return t.clientRequest={action:"unsubscribe",uid:[+e]},t}},{key:"leave",value:function(e){var t=this._getWorkerManagerMsg();return t.clientRequest={action:"leave",uid:+e},t}}]),e}(),S=i(0),g=i.n(S),w=function(){function e(t,i){r()(this,e),this.appId=t.appId,this.channel=t.channel,this.uid=t.uid,this.sid=t.sid,this.role=t.role,this.channelKey=t.channelKey,this.clientId="client",this.option=t,this.timers=new Set,this.reportManager=t.reportManager,this.clientEmitter=i,this.emitter=new f,this.on=this.emitter.on,this.off=this.emitter.off,this.emit=this.emitter.emit,this.join=this.join.bind(this),this.msgManager=new E(t)}var t,i,n;return a()(e,[{key:"connect",value:function(){var e=this;return new Promise((function(t,i){e.ws=new y(e.option,e.emitter),e.ws.connect(),e.on("onmessage",e._onMessage.bind(e));e.on("socketError",i),e.on("onopen",(function i(){e.off&&e.off("onopen",i),e._ping(),t()})),e.on("onclose",(function(){return e.clientEmitter.emit("error",{code:904,reason:"websocket disconnected"})}))}))}},{key:"_onMessage",value:function(e){if(e&&e.data){var t=JSON.parse(e.data);if(t&&"pong"!==t.command){p.default.debug("worker message: ",t);try{this.reportManager.report("serverEvent",{header:{sid:this.sid,cname:this.channel,uid:this.uid,success:!0},body:{action:"serverEvent",details:t,req_ts:+new Date}})}catch(e){}}if(t.requestId&&this.emit(t.requestId,t),"serverStatus"===t.command){if(t.code&&200!==t.code){if(503===t.code)return;this.clientEmitter.emit("error",{code:t.code,reason:t.reason||"server error"})}if(t.serverStatus){p.default.info("Receive message from server: ".concat(JSON.stringify(t.serverStatus)));var i=t.serverStatus.action;if("audio-mute"==i)return t.serverStatus.mute?this.clientEmitter.emit("mute-audio",{uid:t.serverStatus.uid}):this.clientEmitter.emit("unmute-audio",{uid:t.serverStatus.uid});if("video-mute"==i)return t.serverStatus.mute?this.clientEmitter.emit("mute-video",{uid:t.serverStatus.uid}):this.clientEmitter.emit("unmute-video",{uid:t.serverStatus.uid});this.clientEmitter.emit(i,t.serverStatus)}}}}},{key:"_sendMessage",value:function(e){var t=this;if(this.ws)return new Promise((function(i,n){if(!t.isWSConnected())return n({code:904,reason:"websocket disconnected",wsurl:t.getWSUrl()});"ping"!==e.command&&p.default.debug("send to woker: ",e);var r,s=e?e.requestId:null,a=function e(a){if(t.ws)return t.off(s,e),clearTimeout(r),t.timers.delete(r),200==a.code?i(a.serverResponse):n({code:a.code,reason:a.msg||a.reason,serverResponse:a.serverResponse,wsurl:t.getWSUrl()})};if(!s)return n({code:902,reason:"no requestid"});t.ws.sendMessage(JSON.stringify(e)),t.on(s,a),r=setTimeout((function(){return a({code:903,reason:"time out"})}),1e4),t.timers.add(r)}))}},{key:"_ping",value:function(){var e=this;this.pingTimer=setInterval((function(){e.ws.sendMessage(JSON.stringify(e.msgManager.ping()))}),3e3)}},{key:"setRole",value:function(e){return this._sendMessage(this.msgManager.setRole(e))}},{key:"rejoin",value:function(e){return this._sendMessage(this.msgManager.rejoin(this.appId,this.channel,this.uid,this.channelKey,e,this.role))}},{key:"join",value:function(){return this._sendMessage(this.msgManager.join(this.appId,this.channel,this.uid,this.channelKey,this.role))}},{key:"send",value:function(e){return this._sendMessage(this.msgManager.send(e))}},{key:"updatePushUrl",value:function(){return this._sendMessage(this.msgManager.updatePushUrl())}},{key:"publish",value:function(){return this._sendMessage(this.msgManager.publish(this.uid))}},{key:"unpublish",value:function(){return this._sendMessage(this.msgManager.unpublish(this.uid))}},{key:"subscribe",value:function(e){return this._sendMessage(this.msgManager.subscribe(e))}},{key:"unsubscribe",value:function(e){return this._sendMessage(this.msgManager.unsubscribe(e))}},{key:"mute",value:function(e,t){return this._sendMessage(this.msgManager.mute(e,t))}},{key:"unmute",value:function(e,t){return this._sendMessage(this.msgManager.unmute(e,t))}},{key:"muteLocal",value:function(e){return this._sendMessage(this.msgManager.muteLocal(this.uid,e))}},{key:"unmuteLocal",value:function(e){return this._sendMessage(this.msgManager.unmuteLocal(this.uid,e))}},{key:"leave",value:function(){return this._sendMessage(this.msgManager.leave(this.uid))}},{key:"isWSConnected",value:function(){return!!this.ws&&this.ws.isConnected()}},{key:"getWSUrl",value:function(){return this.ws.serverlist[this.ws.index]}},{key:"destroy",value:function(e){var t=this;clearInterval(this.pingTimer),this.timers.forEach((function(e){clearInterval(e)})),this.timers=null,this.ws&&this.ws.destroy((function(){t.ws=null,t.emitter=null,t.on=null,t.off=null,t.emit=null,e&&e()}))}},{key:"startChannelMediaRelay",value:(n=d()(h.a.mark((function e(t){var i,n,r,s,a,o=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.channelMediaRelayController){e.next=2;break}throw new S.ChannelMediaError("RELAY_ALREADY_START","",S.CHANNEL_MEDIA_RELAY_ERROR.RELAY_ALREADY_START);case 2:return i=function(e){o.clientEmitter.emit({type:"channel-media-relay-event",code:e})},n=function(e,t,i){e===S.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE&&t===S.CHANNEL_MEDIA_RELAY_ERROR.SERVER_CONNECTION_LOST&&(o.channelMediaRelayController.dispose(),o.channelMediaRelayController=null),o.clientEmitter.emit({type:"channel-media-relay-state",state:e,code:t,data:i})},r={token:this.appId,appId:this.appId,cname:this.channel,uid:this.uid,sid:this.sid,clientId:this.clientId},this.channelMediaRelayController=new g.a(r,this.clientId),this.channelMediaRelayController.on("event",i),this.channelMediaRelayController.on("state",n),e.prev=8,e.next=11,this.channelMediaRelayController.startChannelMediaRelay(t);case 11:e.next=23;break;case 13:throw e.prev=13,e.t0=e.catch(8),p.default.debug("[".concat(this.clientId,"] startChannelMediaRelay exception: ").concat(JSON.stringify(e.t0))),s=S.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,a="",a=e.t0 instanceof S.ChannelMediaError?"SetSourceChannelStatus"===e.t0.data||e.t0.data&&e.t0.data.serverResponse&&"SetSourceChannel"===e.t0.data.serverResponse.command?"FAILED_JOIN_SRC":"SetDestChannelStatus"===e.t0.data||e.t0.data&&e.t0.data.serverResponse&&"SetDestChannel"===e.t0.data.serverResponse.command?"FAILED_JOIN_DEST":e.t0.data&&e.t0.data.serverResponse&&"StartPacketTransfer"===e.t0.data.serverResponse.command?"FAILED_PACKET_SENT_TO_DEST":e.t0.message===S.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||e.t0.message===S.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":e.t0.message===S.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||e.t0.message===S.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":e.t0.message===S.CHANNEL_MEDIA_ERROR.AP_REQUEST_TIMEOUT?"NO_RESOURCE_AVAILABLE":e.t0.message===S.CHANNEL_MEDIA_ERROR.WS_ABORT||e.t0.message===S.CHANNEL_MEDIA_ERROR.AP_REQUEST_ABORT?"OPERATION_ABORT":"INTERNAL_ERROR":"INTERNAL_ERROR",this.clientEmitter.emit({type:"channel-media-relay-state",state:s,code:S.CHANNEL_MEDIA_RELAY_ERROR[a]}),this.channelMediaRelayController&&(this.channelMediaRelayController.dispose(),this.channelMediaConfig=null,this.channelMediaRelayController=null),this.clientEmitter.emit({type:"channel-media-relay-state",state:S.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new S.ChannelMediaError(a,null,S.CHANNEL_MEDIA_RELAY_ERROR[a]);case 23:this.clientEmitter.emit({type:"channel-media-relay-state",state:S.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_RUNNING,code:S.CHANNEL_MEDIA_RELAY_ERROR.RELAY_OK}),this.channelMediaConfig=t;case 25:case"end":return e.stop()}}),e,this,[[8,13]])}))),function(e){return n.apply(this,arguments)})},{key:"updateChannelMediaRelay",value:(i=d()(h.a.mark((function e(t){var i,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.channelMediaRelayController){e.next=2;break}throw new S.ChannelMediaError("RELAY_NOT_START",null,S.CHANNEL_MEDIA_RELAY_ERROR.RELAY_NOT_START);case 2:return e.prev=2,e.next=5,this.channelMediaRelayController.updateChannelMediaRelay(t);case 5:e.next=18;break;case 7:throw e.prev=7,e.t0=e.catch(2),p.default.debug("[".concat(this.clientId,"] updateChannelMediaRelay exception: ").concat(JSON.stringify(e.t0))),i=S.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,n="",n=e.t0 instanceof S.ChannelMediaError?e.t0.message===S.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||e.t0.message===S.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":e.t0.message===S.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||e.t0.message===S.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":e.t0.message===S.CHANNEL_MEDIA_ERROR.WS_ABORT||e.t0.message===S.CHANNEL_MEDIA_ERROR.AP_REQUEST_ABORT?"OPERATION_ABORT":"INTERNAL_ERROR":"INTERNAL_ERROR",this.clientEmitter.emit({type:"channel-media-relay-event",code:S.CHANNEL_MEDIA_RELAY_EVENT.PACKET_UPDATE_DEST_CHANNEL_REFUSED}),this.clientEmitter.emit({type:"channel-media-relay-state",state:i,code:S.CHANNEL_MEDIA_RELAY_ERROR[n]}),this.channelMediaRelayController&&(this.channelMediaRelayController.dispose(),this.channelMediaConfig=null,this.channelMediaRelayController=null),this.clientEmitter.emit({type:"channel-media-relay-state",state:S.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new S.ChannelMediaError(n,null,S.CHANNEL_MEDIA_RELAY_ERROR[n]);case 18:this.channelMediaConfig=t;case 19:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return i.apply(this,arguments)})},{key:"stopChannelMediaRelay",value:(t=d()(h.a.mark((function e(){var t,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.channelMediaRelayController){e.next=2;break}throw new S.ChannelMediaError("RELAY_NOT_START",null,S.CHANNEL_MEDIA_RELAY_ERROR.RELAY_NOT_START);case 2:return e.prev=2,e.next=5,this.channelMediaRelayController.stopChannelMediaRelay();case 5:e.next=17;break;case 7:throw e.prev=7,e.t0=e.catch(2),p.default.debug("[".concat(this.clientId,"] stopChannelMediaRelay exception: ").concat(JSON.stringify(e.t0))),t=S.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,i="",i=e.t0 instanceof S.ChannelMediaError?e.t0.message===S.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||e.t0.message===S.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":e.t0.message===S.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||e.t0.message===S.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":"INTERNAL_ERROR":"INTERNAL_ERROR",this.clientEmitter.emit({type:"channel-media-relay-state",state:t,code:S.CHANNEL_MEDIA_RELAY_ERROR[i]}),this.channelMediaRelayController&&(this.channelMediaRelayController.dispose(),this.channelMediaConfig=null,this.channelMediaRelayController=null),this.emit({type:"channel-media-relay-state",state:S.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new S.ChannelMediaError(i,null,S.CHANNEL_MEDIA_RELAY_ERROR[i]);case 17:this.channelMediaConfig=null,this.channelMediaRelayController=null;case 19:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(){return t.apply(this,arguments)})}]),e}(),m=i(28).ReportServiceClient,_=i(8).default,R=i(14).VosdkHeader,k=i(13),b=function(){function e(){r()(this,e),this.transport=new _.TXHRTransport("https://uni-webcollector.agora.io/report"),this.protocol=new _.TJSONProtocol(this.transport),this.client=new m(this.protocol),this.seqId=0,this._cache=[],this.isReporting=!1,this.retryCount=0}return a()(e,[{key:"generateHeader",value:function(e){if(e&&e.sid)return new R({sid:e.sid,cname:e.cname||"",lts:e.lts,elapse:e.lts-this.startTime,uid:e.uid,success:e.success})}},{key:"report",value:function(e,t){var i=null;if(t.header&&(t.header.lts=+new Date,"sessionStart"===e&&(this.startTime=t.header.lts),i=this.generateHeader(t.header)),t.body&&i){var n=t.body;switch(e){case"sessionStart":(r=new k({miniappSession:!0})).uri=8e3,r.miniappSession.header=i,r.miniappSession.appid=n.appId,r.miniappSession.uname=n.uname,r.miniappSession.ver=l.SDK_VERSION,r.miniappSession.dk=n.dk,r.miniappSession.details=JSON.stringify({seq:this.seqId++});break;case"chooseServer":(r=new k({miniappJoinChooseServer:!0})).uri=8001,r.miniappJoinChooseServer.header=i,r.miniappJoinChooseServer.csurl=n.csurl,r.miniappJoinChooseServer.ec=n.ec,r.miniappJoinChooseServer.gatewaylist=n.gatewaylist,r.miniappJoinChooseServer.details=JSON.stringify({seq:this.seqId++});break;case"connectWebSocket":(r=new k({miniappConnectWebSocket:!0})).uri=8002,r.miniappConnectWebSocket.header=i,r.miniappConnectWebSocket.ec=n.ec,r.miniappConnectWebSocket.wsurl=n.wsurl,r.miniappConnectWebSocket.details=JSON.stringify({seq:this.seqId++});break;case"join":(r=new k({miniappJoin:!0})).uri=8003,r.miniappJoin.header=i,r.miniappJoin.ec=n.ec,r.miniappJoin.isrejoin=n.isrejoin,r.miniappJoin.details=JSON.stringify({seq:this.seqId++,appId:n.appId,wsurl:n.wsurl});break;case"publish":(r=new k({miniappPublish:!0})).uri=8004,r.miniappPublish.header=i,r.miniappPublish.ec=n.ec,r.miniappPublish.pushurl=n.pushurl,r.miniappPublish.details=JSON.stringify({seq:this.seqId++});break;case"unpublish":(r=new k({miniappUnpublish:!0})).uri=8005,r.miniappUnpublish.header=i,r.miniappUnpublish.ec=n.ec,r.miniappUnpublish.details=JSON.stringify({seq:this.seqId++});break;case"subscribe":(r=new k({miniappSubscribe:!0})).uri=8006,r.miniappSubscribe.header=i,r.miniappSubscribe.ec=n.ec,r.miniappSubscribe.pullurl=n.pullurl,r.miniappSubscribe.peerid=n.peerid,r.miniappSubscribe.details=JSON.stringify({seq:this.seqId++});break;case"unsubscribe":(r=new k({miniappUnsubscribe:!0})).uri=8007,r.miniappUnsubscribe.header=i,r.miniappUnsubscribe.ec=n.ec,r.miniappUnsubscribe.peerid=n.peerid,r.miniappUnsubscribe.details=JSON.stringify({seq:this.seqId++});break;case"leave":(r=new k({miniappLeave:!0})).uri=8008,r.miniappLeave.header=i,r.miniappLeave.ec=n.ec,r.miniappLeave.details=JSON.stringify({seq:this.seqId++});break;case"pusherState":(r=new k({miniappPusherState:!0})).uri=8010,r.miniappPusherState.header=i,r.miniappPusherState.url=n.url,r.miniappPusherState.code=n.code,r.miniappPusherState.status=n.status,r.miniappPusherState.error=n.error,r.miniappPusherState.details=JSON.stringify({seq:this.seqId++});break;case"playerState":(r=new k({miniappPlayerState:!0})).uri=8011,r.miniappPlayerState.header=i,r.miniappPlayerState.url=n.url,r.miniappPlayerState.code=n.code,r.miniappPlayerState.status=n.status,r.miniappPlayerState.error=n.error,r.miniappPlayerState.details=JSON.stringify({seq:this.seqId++});break;case"serverEvent":(r=new k({miniappServerEvent:!0})).uri=8009,r.miniappServerEvent.header=i,r.miniappServerEvent.action=n.action,r.miniappServerEvent.details=JSON.stringify(n.details),r.miniappServerEvent.req_ts=n.req_ts}}if(this._cache.push(r),!this.isReporting&&this._cache.length>0){var r=this._cache.shift();this._report(r)}}},{key:"_report",value:function(e){var t=this;this.isReporting=!0,this.client.Report(e,(function(i){if(i){p.default.debug("Report failed: ",i,e);var n=t.retryCount++<2?200:1e4;setTimeout((function(){t._report(e)}),n)}else{p.default.debug("Report succcess: ",e);var r=t._cache.shift();r?t._report(r):t.isReporting=!1}}))}}]),e}(),I=i(2),C=function(){function e(t){var i=this;r()(this,e),this.emitter=new f,this.on=this.emitter.on,this.off=this.emitter.off,this.sid=Object(o.generateSessionId)(),this.pushUrl=null,this.playUrls=new Map,this.servers=t&&t.servers,this.reportManager=new b,this.role="broadcaster",this.emitter.on("stream-removed",(function(e){i.playUrls&&i.playUrls.delete(e.uid)}))}return a()(e,[{key:"init",value:function(e,t,i){if(!e||"string"!=typeof e||"null"===e.toLowerCase())throw Error("Invalid appId");this.appId=e.trim(),this.reportManager.report("sessionStart",{header:{sid:this.sid,lts:+new Date,success:!0},body:{appId:e}}),t&&t()}},{key:"setRole",value:function(e,t,i){if("broadcaster"===!e&&"audience"===!e)throw Error("Invalid role");this.role=e,this.worker&&this.worker.setRole(e).then((function(e){setTimeout((function(){if(!e)return t&&t();t&&t({updateURL:e["update-url"]})}),1)})).catch((function(){i&&i()}))}},{key:"rejoin",value:function(e,t,i,n,r,s){var a=this;if(!this.worker){if(e){if("string"!=typeof e||"null"===e.toLowerCase())throw Error("Invalid channelKey")}else e=this.appId;if(!t||"string"!=typeof t||"null"===t.toLowerCase()||t.length>128)throw Error("Invalid channel");if(this.uid=i||Object(o.random)(1e7),this.uid=Number.parseInt(this.uid),!Object(o.is32Uint)(this.uid))throw new Error("Invalid uid type");this.channel=t,this.worker=new w({appId:this.appId,channel:this.channel,uid:this.uid,sid:this.sid,role:this.role,servers:this.servers,channelKey:e,reportManager:this.reportManager},this.emitter),this.worker.connect().then((function(){return a.worker.rejoin(n)})).then((function(){try{a.reportManager.report("join",{header:{sid:a.sid,cname:a.channel,uid:a.uid,success:!0},body:{isrejoin:!0,appId:a.appId,wsurl:a.worker&&a.worker.getWSUrl()}})}catch(e){}setTimeout((function(){r&&r(this.uid)}),1)})).catch((function(e){try{a.reportManager.report("join",{header:{sid:a.sid,cname:a.channel,uid:a.uid,success:!1},body:{ec:JSON.stringify(e),appId:a.appId,wsurl:a.worker&&a.worker.getWSUrl()}})}catch(e){}a.destroy(),s&&s(e)}))}}},{key:"join",value:function(e,t,i,n,r){var s=this;if(!this.worker){if(e){if("string"!=typeof e||"null"===e.toLowerCase())throw Error("Invalid channelKey")}else e=this.appId;if(!t||"string"!=typeof t||"null"===t.toLowerCase()||t.length>128)throw Error("Invalid channel");if(this.uid=i||Object(o.random)(1e7),this.uid=Number.parseInt(this.uid),!Object(o.is32Uint)(this.uid))throw new Error("Invalid uid type");this.channel=t,this.worker=new w({appId:this.appId,channel:this.channel,uid:this.uid,sid:this.sid,role:this.role,servers:this.servers,channelKey:e,reportManager:this.reportManager},this.emitter),this.worker.connect().then((function(){return s.worker.join()})).then((function(){try{s.reportManager.report("join",{header:{sid:s.sid,cname:s.channel,uid:s.uid,success:!0},body:{isrejoin:!1,appId:s.appId,wsurl:s.worker&&s.worker.getWSUrl()}})}catch(e){}setTimeout((function(){n&&n(this.uid)}),1)})).catch((function(e){try{s.reportManager.report("join",{header:{sid:s.sid,cname:s.channel,uid:s.uid,success:!1},body:{ec:JSON.stringify(e),appId:s.appId,wsurl:e.wsurl||s.worker&&s.worker.getWSUrl()}})}catch(e){}s.destroy(),r&&r(e)}))}}},{key:"publish",value:function(e,t){var i=this;this._checkWorker(),this.worker.publish().then((function(t){i.pushUrl=t.url;try{i.reportManager.report("publish",{header:{sid:i.sid,cname:i.channel,uid:i.uid,success:!0},body:{pushurl:t.url}})}catch(e){}setTimeout((function(){e&&e(t.url)}),1)})).catch((function(e){i.reportManager.report("publish",{header:{sid:i.sid,cname:i.channel,uid:i.uid,success:!1},body:{ec:JSON.stringify(e)}}),t&&t(e)}))}},{key:"unpublish",value:function(e,t){var i=this;this._checkWorker(),this.worker.unpublish().then((function(t){i.pushUrl=null;try{i.reportManager.report("unpublish",{header:{sid:i.sid,cname:i.channel,uid:i.uid,success:!0},body:{}})}catch(e){}setTimeout((function(){e&&e()}),1)})).catch((function(e){i.reportManager.report("unpublish",{header:{sid:i.sid,cname:i.channel,uid:i.uid,success:!1},body:{ec:JSON.stringify(e)}}),t&&t(e)}))}},{key:"subscribe",value:function(e,t,i){var n=this;this._checkUid(e),this._checkWorker(),this.worker.subscribe(e).then((function(i){n.playUrls.set(e,i.url);try{n.reportManager.report("subscribe",{header:{sid:n.sid,cname:n.channel,uid:n.uid,success:!0},body:{pullurl:i.url}})}catch(e){}setTimeout((function(){t&&t(i.url,i.rotation)}),1)})).catch((function(e){n.reportManager.report("subscribe",{header:{sid:n.sid,cname:n.channel,uid:n.uid,success:!1},body:{ec:JSON.stringify(e)}}),i&&i(e)}))}},{key:"unsubscribe",value:function(e,t,i){var n=this;this._checkUid(e),this._checkWorker(),this.worker.unsubscribe(e).then((function(i){n.playUrls.delete(e);try{n.reportManager.report("unsubscribe",{header:{sid:n.sid,cname:n.channel,uid:n.uid,success:!1},body:{}})}catch(e){}setTimeout((function(){t&&t()}),1)})).catch((function(e){n.reportManager.report("unsubscribe",{header:{sid:n.sid,cname:n.channel,uid:n.uid,success:!1},body:{ec:JSON.stringify(e)}}),i&&i(e)}))}},{key:"mute",value:function(e,t,i,n){if(this._checkUid(e),this._checkWorker(),"video"!==t&&"audio"!==t&&"all"!==t)throw new Error('target should be "video", "audio" or "all"');this.worker.mute(e,t).then((function(e){setTimeout((function(){i&&i()}),1)})).catch((function(e){n&&n(e)}))}},{key:"unmute",value:function(e,t,i,n){if(this._checkUid(e),this._checkWorker(),"video"!==t&&"audio"!==t&&"all"!==t)throw new Error('target should be "video", "audio" or "all"');this.worker.unmute(e,t).then((function(e){setTimeout((function(){i&&i()}),1)})).catch((function(e){n&&n(e)}))}},{key:"muteLocal",value:function(e,t,i){if(this._checkWorker(),"video"!==e&&"audio"!==e&&"all"!==e)throw new Error('target should be "video", "audio" or "all"');this.worker.muteLocal(e).then((function(e){setTimeout((function(){t&&t()}),1)})).catch((function(e){i&&i(e)}))}},{key:"unmuteLocal",value:function(e,t,i){if(this._checkWorker(),"video"!==e&&"audio"!==e&&"all"!==e)throw new Error('target should be "video", "audio" or "all"');this.worker.unmuteLocal(e).then((function(e){setTimeout((function(){t&&t()}),1)})).catch((function(e){i&&i(e)}))}},{key:"leave",value:function(e,t){var i=this;this.worker&&this.worker.isWSConnected()&&this.worker.leave().then((function(t){try{i.reportManager.report("leave",{header:{sid:i.sid,cname:i.channel,uid:i.uid,success:!0},body:{}})}catch(e){}i.destroy((function(){setTimeout((function(){e&&e()}),1)}))})).catch((function(e){t&&t(e)}))}},{key:"_checkUid",value:function(e){if(!e||"number"!=typeof e||!Object(o.is32Uint)(e))throw new Error("Invalid uid type")}},{key:"_checkWorker",value:function(){if(!this.worker||!this.worker.isWSConnected())throw new Error("Disconnected from server")}},{key:"isConnected",value:function(){return!(!this.worker||!this.worker.isWSConnected())}},{key:"updatePusherStateChange",value:function(e){if(this.pushUrl){var t=e.detail.code;if(1008==t||t<0){var i=1008==t;this.reportManager&&this.reportManager.report("pusherState",{header:{sid:this.sid,cname:this.channel,uid:this.uid,success:i},body:{url:this.pushUrl,code:t}})}}}},{key:"updatePlayerStateChange",value:function(e,t){var i=this.playUrls.get(e);if(i){var n=t.detail.code;if(2004==n||n<0||n>3e3){var r=2004==n;this.reportManager&&this.reportManager.report("playerState",{header:{sid:this.sid,cname:this.channel,uid:e,success:r},body:{url:i,code:n}})}}}},{key:"updatePusherNetStatus",value:function(e){}},{key:"updatePlayerNetStatus",value:function(e,t){}},{key:"updatePusherError",value:function(e){}},{key:"updatePlayerError",value:function(e,t){}},{key:"send",value:function(e,t,i){this._checkWorker(),this.worker.send(e).then((function(e){t&&t(e)})).catch((function(e){i&&i(e)}))}},{key:"updatePushUrl",value:function(e,t){this._checkWorker(),this.worker.updatePushUrl().then((function(t){setTimeout((function(){e&&e(t)}),1)})).catch((function(e){t&&t(e)}))}},{key:"destroy",value:function(e,t){var i=this;this.worker?(this.worker.destroy((function(){i.pushUrl=null,i.playUrls=null,e&&e()})),this.worker=null):(this.pushUrl=null,this.playUrls=null,e&&e())}},{key:"startChannelMediaRelay",value:function(e,t){if(!(e instanceof S.ChannelMediaRelayConfiguration))throw"Configration should be instance of [ChannelMediaRelayConfiguration]";var i=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfos();if(Object(I.isEmpty)(i))throw"srcChannelMediaInfo should not be empty";if(Object(I.isEmpty)(n)||0===n.length)throw"destChannelMediaInfos should not be empty";if(p.default.debug("[startChannelMediaRelay]: srcInfo: ",i," destInfo: ",n),!Object(o.is32Uint)(i.uid))throw"Invalid uid in srcChannelMediaInfo";if(!Object(I.isValidChannelName)(i.channelName))throw"Invalid channelName in srcChannelMediaInfo";if(i.token&&!Object(I.isValidToken)(i.token))throw"Invalid token in srcChannelMediaInfo";if(n.forEach((function(e){if(!Object(o.is32Uint)(e.uid))throw"Invalid uid in destChannelMediaInfo";if(!Object(I.isValidChannelName)(e.channelName))throw"Invalid channelName in destChannelMediaInfo";if(e.token&&!Object(I.isValidToken)(e.token))throw"Invalid token in destChannelMediaInfo"})),!this.worker)throw"startChannelMediaRelay should be used after join";this.worker.startChannelMediaRelay(e).then((function(){t&&t()})).catch((function(e){t&&t(e)}))}},{key:"updateChannelMediaRelay",value:function(e,t){if(!(e instanceof S.ChannelMediaRelayConfiguration))throw"Configration should be instance of [ChannelMediaRelayConfiguration]";var i=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfos();if(Object(I.isEmpty)(i))throw"srcChannelMediaInfo should not be empty";if(Object(I.isEmpty)(n)||0===n.length)throw"destChannelMediaInfos should not be empty";if(p.default.debug("[updateChannelMediaRelay]: srcInfo: ",i," destInfo: ",n),!Object(o.is32Uint)(i.uid))throw"Invalid uid in srcChannelMediaInfo";if(!Object(I.isValidChannelName)(i.channelName))throw"Invalid channelName in srcChannelMediaInfo";if(i.token&&!Object(I.isValidToken)(i.token))throw"Invalid token in srcChannelMediaInfo";if(n.forEach((function(e){if(!Object(o.is32Uint)(e.uid))throw"Invalid uid in destChannelMediaInfo";if(!Object(I.isValidChannelName)(e.channelName))throw"Invalid channelName in destChannelMediaInfo";if(e.token&&!Object(I.isValidToken)(e.token))throw"Invalid token in destChannelMediaInfo"})),!this.worker)throw"updateChannelMediaRelay should be used after join";this.worker.updateChannelMediaRelay(e).then((function(){t&&t()})).catch((function(e){t&&t(e)}))}},{key:"stopChannelMediaRelay",value:function(e){p.default.debug("[stopChannelMediaRelay]"),this.worker.stopChannelMediaRelay().then((function(){e&&e()})).catch((function(t){e&&e(t)}))}}]),e}()}])}));
//# sourceMappingURL=mini-app-sdk-production.js.map