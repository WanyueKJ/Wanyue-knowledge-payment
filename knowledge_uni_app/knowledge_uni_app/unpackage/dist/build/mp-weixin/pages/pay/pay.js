(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/pay/pay"],{"1e34":function(e,t,a){"use strict";a.r(t);var i=a("9a83"),n=a("9ea9");for(var o in n)"default"!==o&&function(e){a.d(t,e,(function(){return n[e]}))}(o);a("2b3e");var s,r=a("f0c5"),d=Object(r["a"])(n["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],s);t["default"]=d.exports},"2b3e":function(e,t,a){"use strict";var i=a("9946"),n=a.n(i);n.a},9369:function(e,t,a){"use strict";(function(e){a("1754");i(a("66fd"));var t=i(a("1e34"));function i(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=a,e(t.default)}).call(this,a("543d")["createPage"])},9946:function(e,t,a){},"9a83":function(e,t,a){"use strict";var i;a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return i}));var n=function(){var e=this,t=e.$createElement;e._self._c},o=[]},"9ea9":function(e,t,a){"use strict";a.r(t);var i=a("ce80"),n=a.n(i);for(var o in i)"default"!==o&&function(e){a.d(t,e,(function(){return i[e]}))}(o);t["default"]=n.a},ce80:function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=getApp(),i={data:function(){return{live_info:{},checkstatus:{},allmoney:0,ismaterial:0,hasdefaddress:!1,isCar:"0",carinfo:[],addressdic:{},showpayview:!1,showjifen:!1,payinfo:[],payselected:0,deduct_integral:0,deduct_money:0,jifen_sel:!0,jifen_image_unsel:"../../static/car_1.png",jifen_image_sel:"../../static/car_2.png"}},onReady:function(){},onShow:function(){this.getaddress()},onLoad:function(t){var a=this;if(e.getStorage({key:"openid",success:function(e){getApp().globalData.openid=e.data,console.log(e.data)}}),this.isCar=t.isCar,"isCar"!=this.isCar){console.log("不是从购物车车过来"),console.log(t),this.live_info=JSON.parse(decodeURIComponent(t.info)),void 0==this.live_info[0].sort?this.allmoney=this.live_info[0].price:this.allmoney=this.live_info[0].payval;for(var i=0;i<this.live_info.length;i++){var n=this.live_info[i];1==n.ismaterial&&(this.ismaterial=1)}}else{this.carinfo=JSON.parse(decodeURIComponent(t.info)),this.allmoney=t.money;for(var o=0;o<this.carinfo.length;o++){n=this.carinfo[o];1==n.ismaterial&&(this.ismaterial=1)}}this.getaddress();var s=[],r=[];s="isCar"!=this.isCar?this.live_info:this.carinfo;for(var d=0;d<s.length;d++){n=s[d];var l={};void 0==n.sort?(l["type"]="1",l["typeid"]=n.id):(l["type"]="0",l["typeid"]=n.id),r.push(l)}var c=JSON.stringify(r),f=getApp().globalData;e.request({url:f.site_url+"Cart.getDeduct",method:"POST",data:{uid:f.userinfo.id,token:f.userinfo.token,goods:c},success:function(e){if(0==e.data.data.code){var t=parseFloat(e.data.data.info[0].deduct_integral);a.deduct_money=e.data.data.info[0].deduct_money,t>0&&(a.showjifen=!0,a.allmoney-=a.deduct_money)}}})},methods:{jifensel_unsel:function(){this.jifen_sel=!this.jifen_sel,1==this.jifen_sel?this.allmoney-=this.deduct_money:this.allmoney+=this.deduct_money},pushaddress:function(){e.navigateTo({url:"../address/address"})},cancle:function(){this.showpayview=!1},selectedpayway:function(e){this.payselected=e},fufei:function(){this.buy("wx","3")},buy:function(t,a){var i=this;if("wx"==t&&"3"==a);else if("wx"!=t||"4"!=a)return;var n=[],o=[];n="isCar"!=this.isCar?this.live_info:this.carinfo;for(var s=0;s<n.length;s++){var r=n[s],d={};void 0==r.sort?(d["type"]="1",d["typeid"]=r.id):(d["type"]="0",d["typeid"]=r.id),o.push(d)}var l=JSON.stringify(o),c=getApp().globalData;e.request({url:c.site_url+"Cart.Buy",method:"POST",data:{uid:c.userinfo.id,token:c.userinfo.token,goods:l,payid:a,addrid:"",openid:getApp().globalData.openid,method:this.isCar},success:function(t){if(0==t.data.data.code){if(0==i.allmoney)return e.showToast({title:"支付成功",icon:"none"}),void e.navigateBack({delta:1});t.data.data.info[0].ali,t.data.data.info[0].wx;var a=t.data.data.info[0].small;console.log(t),console.log(a);t.data.data.info[0].orderid,t.data.data.info[0].money;e.requestPayment({provider:"wxpay",timeStamp:String(a.timeStamp),nonceStr:a.nonceStr,package:a.package,signType:"MD5",paySign:a.sign,success:function(t){e.showToast({title:"支付成功",icon:"none"}),e.navigateBack({delta:1}),console.log("success:"+JSON.stringify(t))},fail:function(t){e.showToast({title:"支付失败",icon:"none"}),console.log("fail:"+JSON.stringify(t))}})}else console.log(t),e.showToast({title:t.data.data.msg,icon:"none"})}})},getaddress:function(){var t=this;if(1==this.ismaterial){console.log("GetList");var i=a.globalData;e.request({url:i.site_url+"Addr.GetList",method:"GET",data:{uid:i.userinfo.id,token:i.userinfo.token},success:function(e){var a=e.data.data.info;if(console.log(a),a.length>0){t.hasdefaddress=!0;for(var i=0;i<a.length;i++){var n=a[i];1==n.isdef&&(t.addressdic=n)}}else t.hasdefaddress=!1}})}}}};t.default=i}).call(this,a("543d")["default"])}},[["9369","common/runtime","common/vendor"]]]);